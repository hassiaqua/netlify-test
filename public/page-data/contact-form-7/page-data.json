{"componentChunkName":"component---src-templates-post-js","path":"/contact-form-7/","result":{"data":{"wordpressPost":{"id":"51b5d2c4-9541-5a14-869a-3f958747da8c","title":"「Contact form 7」でできること！WordPressのお問い合わせを使いこなそう！","slug":"contact-form-7","content":"<p>WordPressのお問い合わせフォームといえば、「Contact form 7」が最初の選択肢として上がることが多いと思います。</p>\n<p>そんな、WordPressサイトを構築する上で避けては通れない「Contact form 7」について、できることをまとめました。<strong class=\"marker\">「Contact form 7」と制するものはWordPressのお問い合わせフォームを制する！</strong>ということで、使いこなせるとようになっておくと何かと楽です。</p>\n<div class=\"chat\"><figure class=\"chat-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"><figcaption>はにわまん</figcaption></figure><div class=\"chat-content\">「Contact form 7」の情報はネットにめっちゃ多くて助かりますね...</div></div>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#Contact_form_7\"><span class=\"toc_number toc_depth_1\">1</span> 「Contact form 7」でできること</a><ul><li><a href=\"#i\"><span class=\"toc_number toc_depth_2\">1.1</span> ファイルの添付</a></li><li><a href=\"#i-2\"><span class=\"toc_number toc_depth_2\">1.2</span> 承認チェックボックス</a></li><li><a href=\"#GET\"><span class=\"toc_number toc_depth_2\">1.3</span> GETパラメーター取得</a></li><li><a href=\"#i-3\"><span class=\"toc_number toc_depth_2\">1.4</span> 自動返信</a></li><li><a href=\"#i-4\"><span class=\"toc_number toc_depth_2\">1.5</span> 複数人へ送信</a></li><li><a href=\"#i-5\"><span class=\"toc_number toc_depth_2\">1.6</span> スパムメールを除外</a></li></ul></li><li><a href=\"#Contact_form_7-2\"><span class=\"toc_number toc_depth_1\">2</span> 「Contact form 7」のカスタマイズ</a><ul><li><a href=\"#i-6\"><span class=\"toc_number toc_depth_2\">2.1</span> メールアドレス再入力チェック</a></li><li><a href=\"#i-7\"><span class=\"toc_number toc_depth_2\">2.2</span> ローディングアイコンの変更</a></li><li><a href=\"#i-8\"><span class=\"toc_number toc_depth_2\">2.3</span> 住所の自動入力</a></li><li><a href=\"#1\"><span class=\"toc_number toc_depth_2\">2.4</span> 複数の項目をまとめて1つのエラーに</a></li><li><a href=\"#i-9\"><span class=\"toc_number toc_depth_2\">2.5</span> 確認画面</a></li></ul></li><li><a href=\"#i-10\"><span class=\"toc_number toc_depth_1\">3</span> おわり</a></li></ul></div>\n<h2><span id=\"Contact_form_7\">「Contact form 7」でできること</span></h2>\n<p>「Contact form 7」でできることのまとめです。</p>\n<h3><span id=\"i\">ファイルの添付</span></h3>\n<p>ファイル添付の機能は標準で備わっています。「ファイル」って押すだけで追加できます。機能性もめちゃくちゃ高くて使いやすいです。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-2-700x117.png\" alt=\"\" width=\"700\" class=\"alignnone size-medium wp-image-15232\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-2-700x117.png 700w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-2-768x128.png 768w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-2-1200x201.png 1200w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-2.png 1554w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<p>「ファイルサイズの上限」や「受け入れ可能なファイル形式」も標準で選択できます。pdfとtxtのみ！みたいな作りに簡単にできるわけですね。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-1-700x603.png\" alt=\"\" width=\"500\" class=\"alignnone size-medium wp-image-15231\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-1-700x603.png 700w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-1-768x661.png 768w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-1-1200x1033.png 1200w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-1.png 1254w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<p>送信されるメールにファイルを添付する場合は、「メール」タブの方にある「ファイル添付」に他のタグと同様に入れてあげればOKです！<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-3-700x165.png\" alt=\"\" width=\"400\" class=\"alignnone size-medium wp-image-15233\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-3-700x165.png 700w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-3-768x181.png 768w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-3.png 976w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<p>使い方は公式に詳しく掲載されています。<br />\n→ <a href=\"https://contactform7.com/ja/file-uploading-and-attachment/\" rel=\"noopener nofollow\" target=\"_blank\">ファイルのアップロードとメール添付 | Contact Form 7 [日本語]</a></p>\n<h3><span id=\"i-2\">承認チェックボックス</span></h3>\n<p>「プライバシーポリシーに同意する」みたいな「承認ボタン」も簡単につけることができます。また、このチェックボックスの中にリンクを仕込めるのも「Contact form 7」のいいところです。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-4-700x117.png\" alt=\"\" width=\"700\" class=\"alignnone size-medium wp-image-15236\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-4-700x117.png 700w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-4-768x128.png 768w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-4-1200x201.png 1200w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-4.png 1554w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<p>こんな感じのチェックボックスを作ることが簡単にできるわけです。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-5.png\" alt=\"\" width=\"300\"  class=\"alignnone size-full wp-image-15237\"></p>\n<p>チェックしない限りは送信ボタンを押せないという仕様になっています。個人的に、チェック有無関わらずに押せるようにしておいて、「押さないとダメだよ！」と教えて上げたほうが親切な気がするので以下の設定を加えてあげるといいかもしれません。</p>\n<h4>送信ボタンを押せるようにする</h4>\n<p>その他の設定の箇所で「<code>acceptance_as_validation: on</code>」と入力してあげると、承認ボタンにチェックしてなくても送信ボタンを押せるようになります。</p>\n<p>公式 → <a href=\"https://contactform7.com/ja/acceptance-checkbox/\" rel=\"noopener nofollow\" target=\"_blank\">承諾確認チェックボックス | Contact Form 7 [日本語]</a></p>\n<h3><span id=\"GET\">GETパラメーター取得</span></h3>\n<p>遷移前の値に応じて入力項目を変更したい&#8230;って場合もあるかと思います。「Contact form 7」ではGETパラメーターの取得も標準で対応してくれていて、タグ内に「default:get」を入れるだけです。</p>\n<p>※ URLは例なのでアクセスしても動きません。<br />\n例えば、「https://example.com/contact/?mytitle=記事のタイトルを入れてみる」みたいなURLでお問い合わせフォームにアクセスしたとして、「Contact form 7」側で<code>[text* mytitle default:get]</code>と受け取れば、デフォルトの値としてmytitleのGETパラメーターの値が入ります。</p>\n<p>このように遷移元の値に応じて、動的に変えていけるので、お問い合わせフォームを何個も作る必要はありません！</p>\n<p>公式 → <a href=\"https://contactform7.com/ja/getting-default-values-from-the-context/\" rel=\"noopener nofollow\" target=\"_blank\">文脈からデフォルト値を取得する | Contact Form 7 [日本語]</a></p>\n<h3><span id=\"i-3\">自動返信</span></h3>\n<p>当たり前のように使っているかもしれませんが、お問い合わせしてくれた人に対して自動で返信することができます。</p>\n<p>「メール」タブの下部にある「メール (2) を使用」にチェックしてください。また、返信するために<strong class=\"marker\">お問い合わせフォームの入力欄でメールアドレスを必須</strong>にしておき、送信先にフォームに入力してもらったメールアドレスを指定してあげます。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-9-700x304.png\" alt=\"\" width=\"500\" class=\"alignnone size-medium wp-image-15240\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-9-700x304.png 700w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-9-768x333.png 768w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-9.png 1120w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<h3><span id=\"i-4\">複数人へ送信</span></h3>\n<p>複数にへ送信する場合も簡単で、「送信先」の欄で、<code>,</code>（カンマ）で区切って複数のメールアドスを入れるだけです。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-7-700x100.png\" alt=\"\" width=\"500\" class=\"alignnone size-medium wp-image-15238\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-7-700x100.png 700w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-7-768x110.png 768w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-7.png 906w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<h3><span id=\"i-5\">スパムメールを除外</span></h3>\n<p>お問い合わせフォームをそのまま設置しているだけだと、スパムメールがめちゃくちゃ届きます。これを排除するには「Contact form 7」と「Akismet」のプラグインを掛け合わせることで対応することが可能です。</p>\n<p>まず、<strong class=\"marker\">WordPressのプラグインとしてAkismetが設定されていることが前提</strong>になります。</p>\n<p>その上でメールアドレスの部分に「<code>akismet:author_email</code>」を追加してあげます。これだけで劇的にスパムメールが来なくなります。メールのタグ部分は以下のような感じです。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-8.png\" alt=\"\" width=\"500\"  class=\"alignnone size-full wp-image-15239\" /></p>\n<p>公式 → <a href=\"https://contactform7.com/ja/spam-filtering-with-akismet/\" rel=\"noopener nofollow\" target=\"_blank\">Akismet によるスパムフィルタリング | Contact Form 7 [日本語]</a></p>\n<h2><span id=\"Contact_form_7-2\">「Contact form 7」のカスタマイズ</span></h2>\n<p>標準の機能ではないけどカスタマイズすることで対応できることです。</p>\n<h3><span id=\"i-6\">メールアドレス再入力チェック</span></h3>\n<p>メールアドレスの再入力チェックは標準の機能としてはありませんが、チェック用のフィルターフックでカスタマイズしてあげることで対応することができます。</p>\n<p>使うフィルターフックとしては<code>wpcf7_validate_email*</code>になります。メールアドレス再入力チェックについては、公式にそのまま作り方が書いてあるので、ネット上で拾うより、公式を参考にすることをおすすめします。</p>\n<p>以下のような、２つのメールアドレスのタグを用意しておきます。<br />\n<code>[email* your-email]</code><br />\n<code>[email* your-email-confirm]</code></p>\n<p>その上で、<span class=\"filename\">functions.php</span>で以下のようなコードでチェックさせることが可能になります。</p>\n<blockquote>\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"php\">add_filter( 'wpcf7_validate_email*', 'custom_email_confirmation_validation_filter', 20, 2 );\r\n \r\nfunction custom_email_confirmation_validation_filter( $result, $tag ) {\r\n    if ( 'your-email-confirm' == $tag-&gt;name ) {\r\n        $your_email = isset( $_POST['your-email'] ) ? trim( $_POST['your-email'] ) : '';\r\n        $your_email_confirm = isset( $_POST['your-email-confirm'] ) ? trim( $_POST['your-email-confirm'] ) : '';\r\n \r\n        if ( $your_email != $your_email_confirm ) {\r\n            $result-&gt;invalidate( $tag, \"Are you sure this is the correct address?\" );\r\n        }\r\n    }\r\n \r\n    return $result;\r\n}</code></pre>\n<p>公式 → <a href=\"https://contactform7.com/2015/03/28/custom-validation/\" rel=\"noopener nofollow\" target=\"_blank\">Custom Validation | Contact Form 7</a>\n</p></blockquote>\n<h3><span id=\"i-7\">ローディングアイコンの変更</span></h3>\n<p>ローディングアイコンの変更については、単純にCSSを上書きするだけですね。標準がぼんやりしているgif画像だったりするので、これを<a href=\"https://fontawesome.com/\" rel=\"noopener nofollow\" target=\"_blank\">Font Awesome</a>のアイコンに変えてみます。</p>\n<p>上書きする対象のCSSは<code>.ajax-loader</code>です。FontAwesomeのCSSが読み込めている前提で、具体的には以下のような追記をします。</p>\n<p><i class=\"fas fa-spinner\"></i> ← を回転させるコードです。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-1\">コピー</span><code id=\"code-1\" class=\"css\">div.wpcf7 .ajax-loader {\r\n  background-image: none;\r\n  vertical-align: baseline;\r\n}\r\n\r\ndiv.wpcf7 .ajax-loader::after {\r\n  content: \"\\f110\";\r\n  font-family: \"Font Awesome 5 Free\", sans-serif;\r\n  font-weight: 900;\r\n  animation: rotation 1s linear infinite;\r\n  display: inline-block;\r\n}\r\n\r\n@keyframes rotation {\r\n  0% {\r\n\t\ttransform: rotate(0deg);\r\n\t}\r\n  100% {\r\n\t\ttransform: rotate(360deg);\r\n\t}\r\n}</code></pre>\n<h3><span id=\"i-8\">住所の自動入力</span></h3>\n<p>住所の自動入力も外部のライブラリを使うことで対応が可能です。「Contact form 7」というよりは、「ajaxzip3」を使っているだけになります。</p>\n<p>詳しくは下記で解説しているので参考にしてください。</p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"T2lKCbIw8w\"><p><a href=\"https://haniwaman.com/address-auto/\">WordPressのお問い合わせフォームで郵便番号から住所を自動で入力</a></p></blockquote>\n<p><iframe title=\"&#8220;WordPressのお問い合わせフォームで郵便番号から住所を自動で入力&#8221; &#8212; HPcode\" class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"https://haniwaman.com/address-auto/embed/#?secret=T2lKCbIw8w\" data-secret=\"T2lKCbIw8w\" width=\"500\" height=\"282\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></p>\n<h3><span id=\"1\">複数の項目をまとめて1つのエラーに</span></h3>\n<p>生年月日などインラインで複数項目に分かれている入力エリアの場合に、エラーメッセージを表示すると縦に並んで見栄えが崩れてしまうケースがあります。</p>\n<p>「Contact form 7」では、各フィールドの下にエラーメッセージを表示させるという仕様だからですね。この<strong class=\"marker\">エラーメッセージの表示場所をカスタマイズして、任意の位置に表示</strong>できるように変えていきましょう。</p>\n<ol>\n<li>エラーメッセージを表示させる用のHTMLタグを用意</li>\n<li>エラーメッセージを用意したHTMLタグに移動して表示</li>\n</ol>\n<p>という流れになります。</p>\n<h4>１、エラーメッセージを表示させる用のHTMLタグを用意</h4>\n<p>以下のような感じで、「年」「月」「日」のそれぞれに必須「<code>*</code>」が付いている、空白のまま送信してしまうと、「必須項目に入力してください」的なメッセージが表示されて縦並びとなります。</p>\n<p><code>.wpcf7-birthday-item-error</code>というHTMLタグを識別できるクラスと、移動させたい項目のタグ名をクラス名として指定してあげてください。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-2\">コピー</span><code id=\"code-2\" class=\"html\">西暦[number* your-year]年[number* your-month]月[number* your-day]日\r\n&lt;div class=\"wpcf7-birthday-item-error your-year your-month your-day\"&gt;&lt;/div&gt;\r\n</code></pre>\n<h4>２、エラーメッセージを用意したHTMLタグに移動して表示</h4>\n<pre>function.php<span class=\"code-copy\" data-clipboard-target=\"#code-3\">コピー</span><code id=\"code-3\" class=\"php\">function my_wpcf7_ajax_json_echo( $items, $result ) {\r\n\r\n\t// メッセージを表示させたい場所のタグのエラー用のクラス名.\r\n\t$class_birthday = 'wpcf7-birthday-item-error';\r\n\r\n\t// メッセージの位置を変更したい項目名.\r\n\t$names_birthday = array( 'your-year', 'your-month', 'your-day' );\r\n\r\n\t// 入力エラーがある場合.\r\n\tif ( isset( $items['invalidFields'] ) ) {\r\n\t\tforeach ( $items['invalidFields'] as $k =&gt; $v ) {\r\n\t\t\t$orig = $v['into'];\r\n\t\t\t$name = substr( $orig, strrpos( $orig, '.' ) + 1 );\r\n\r\n\t\t\t// 位置を変更したい項目のみ、エラーを設定するタグのクラス名を差替.\r\n\t\t\tif ( in_array( $name, $names_birthday ) ) {\r\n\t\t\t\t$items['invalidFields'][ $k ]['into'] = \".{$class_birthday}.{$name}\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn $items;\r\n}\r\nadd_filter( 'wpcf7_ajax_json_echo', 'my_wpcf7_ajax_json_echo', 10, 2 );</code></pre>\n<p>※ バージョン5.1.3では動作確認済みですが、バージョンが上がって仕様が変わると動かなくなる可能性もあります。</p>\n<p>こんな感じだったのが<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-10-700x511.png\" alt=\"\" width=\"300\" class=\"alignnone size-medium wp-image-15245\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-10-700x511.png 700w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-10.png 718w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<p>こんな感じに！<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-11-700x112.png\" alt=\"\" width=\"700\" class=\"alignnone size-medium wp-image-15246\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-11-700x112.png 700w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-11-768x123.png 768w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-11-1200x192.png 1200w, https://haniwaman.com/wp-content/uploads/2019/06/contact-form-7-11.png 1472w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<h3><span id=\"i-9\">確認画面</span></h3>\n<p>確認画面は外部のプラグインを追加することで対応することができます。ただし、一般的にイメージされるようなページ遷移しての確認画面ではなく、ajax的な動きで同じ画面上で確認するという動きです。</p>\n<p>詳しい実装方法は以下の記事で紹介しているので参考にしていただければと思います。</p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"f8LWq8nayy\"><p><a href=\"https://haniwaman.com/contact-form-7-add-page/\">Contact Form 7で確認画面と完了画面（サンクスページ）を追加する方法</a></p></blockquote>\n<p><iframe title=\"&#8220;Contact Form 7で確認画面と完了画面（サンクスページ）を追加する方法&#8221; &#8212; HPcode\" class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"https://haniwaman.com/contact-form-7-add-page/embed/#?secret=f8LWq8nayy\" data-secret=\"f8LWq8nayy\" width=\"500\" height=\"282\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe></p>\n<h2><span id=\"i-10\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome -->\n<p>「Contact form 7」でできることをまとめてみました。</p>\n<p>インターネット上の情報もさることながら公式の情報めちゃくちゃ豊富なので、困ったらこちらも覗いてみてください。<br />\n→ <a href=\"https://contactform7.com/ja/\" rel=\"noopener nofollow\" target=\"_blank\">Contact Form 7 | WordPress のお問い合わせフォームプラグイン。シンプル、でも柔軟。 [日本語]</a></p>\n<p>WordPressでサイト構築する上でお問い合わせフォームの実装は避けて通れないレベルで登場するので、最初のお問い合わせフォームとして選ばれがちな「Contact form 7」をどんどん使いやすくしていきましょう！</p>\n","date":"June 28, 2019","categories":[{"name":"WordPress","slug":"wordpress"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"51b5d2c4-9541-5a14-869a-3f958747da8c"}}}