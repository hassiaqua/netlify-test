{"componentChunkName":"component---src-templates-post-js","path":"/cache-delete/","result":{"data":{"wordpressPost":{"id":"0b06e0b6-cae7-5d70-abe6-e46c1f8760cf","title":"「キャッシュの削除お願いします」をなくせ！強制的にCSSのキャッシュを無効化する２つの方法","slug":"cache-delete","content":"<p>～ とあるサイトのカスタマイズ案件にて ～</p>\n<ul>\n<li>わたし「対応が完了したので、ご確認いただけますでしょうか。」</li>\n<li style=\"color:#E57373;font-weight:bold;\">クライアント「変更されていません。」</li>\n<li>わたし「大変お手数ですが、キャッシュを削除してからご確認いただけますでしょうか。」</li>\n<li style=\"color:#E57373;font-weight:bold;\">クライアント「キャッシュの削除ってなんですか？」</li>\n<li>わたし「PCだとCtrl + Shift + R、スマホだと各機種によって異なるため、「[機種名] キャッシュ削除」で検索していただけますか。」</li>\n<li style=\"color:#E57373;font-weight:bold;\">クライアント「まだ変わっていません。」</li>\n<li>わたし「どのような画面が表示されていますか？」</li>\n<li style=\"color:#E57373;font-weight:bold;\">クライアント「（キャプチャー添付）」</li>\n<li>わたし「またキャッシュが残ってますね。。大変お手数ですが、もう一度さきほどのキャッシュの削除をお試しいただけますか？」</li>\n</ul>\n<p><span class=\"font-ll\">うわあああああああああああ</span><br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2018/05/sick_noiroze_man.png\" alt=\"\" width=\"400\" height=\"400\" class=\"alignnone size-full wp-image-6389\" srcset=\"https://haniwaman.com/wp-content/uploads/2018/05/sick_noiroze_man.png 400w, https://haniwaman.com/wp-content/uploads/2018/05/sick_noiroze_man-150x150.png 150w\" sizes=\"(max-width: 400px) 100vw, 400px\" /></p>\n<p>キャッシュの削除1つでこれだけのやり取りが頻発します。</p>\n<p>この無駄なやり取りを排除すべく、<strong class=\"marker\">ブラウザのキャッシュに依存させない方法</strong>を紹介します。知ってしまえば簡単ですので、キャッシュの不毛なやり取りで疲れている方はぜひお試しください。</p>\n<div class=\"chat\"><figure class=\"chat-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"><figcaption>はにわまん</figcaption></figure><div class=\"chat-content\">コーダーになって一番やっているやり取りかもしれません笑</div></div>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#_GET\"><span class=\"toc_number toc_depth_1\">1</span> その１ GETパラメーターを付与</a><ul><li><a href=\"#WordPressfunctionsphp\"><span class=\"toc_number toc_depth_2\">1.1</span> WordPressではfunctions.phpを修正</a></li></ul></li><li><a href=\"#_HTML\"><span class=\"toc_number toc_depth_1\">2</span> その２ HTMLに直書き</a><ul><li><a href=\"#WordPressCSS\"><span class=\"toc_number toc_depth_2\">2.1</span> WordPressでは「追加CSS」に追加する</a></li></ul></li><li><a href=\"#i\"><span class=\"toc_number toc_depth_1\">3</span> おわり</a></li></ul></div>\n<h2><span id=\"_GET\">その１ GETパラメーターを付与</span></h2>\n<p>GETパラメータを付与することで、ブラウザが新しいcssとして読み込んでくれます。</p>\n<p>GETパラメータとはファイルパスの末尾に付く<code>?</code>以降の「名前=値」で作られたもの。Webサービスとか作る際はよく使われます。</p>\n<p>一般的なWebサイトではGETパラメーターは使われておらず、こんな感じです。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"html\">&lt;link rel=\"stylesheet\" href=\"style.css\"&gt;\r\n</code></pre>\n<p>GETパラメーターを使えば、「.css」の後ろに<code>?ver=1.0.1</code>の形でバージョン情報を付与することができます。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-1\">コピー</span><code id=\"code-1\" class=\"html\">&lt;link rel=\"stylesheet\" href=\"style.css?ver=1.0.1\"&gt;\r\n</code></pre>\n<p><span class=\"filename\">style.css</span>と<span class=\"filename\">style.css?ver=1.0.1</span>は別物として扱われます。お客様のcssファイルを更新した際は<code>?ver=1.0.1</code>のような情報を付与して納品すると、キャッシュの影響を受けずに確認していただくことができるわけですね。</p>\n<p>さらに更新した場合は、<span class=\"filename\">style.css?ver=1.0.2</span>のように数字を増やしていくだけなので、こちらとしても管理しやすくなります。</p>\n<p>このように、<strong class=\"marker\">.cssの末尾に新しいバージョン情報を付与してブラウザに再読込させましょう！</strong></p>\n<p>※ JavaScriptも同様にできます</p>\n<h3><span id=\"WordPressfunctionsphp\">WordPressでは<span class=\"filename\">functions.php</span>を修正</span></h3>\n<p>静的なHTMLファイルであれば、HTMLファイルの中身を直接書き換えてあげればいいのですが、WordPressではCSSやJavaScriptは<span class=\"filename\">functions.php</span>で管理されています。</p>\n<p>こんな感じで記載されているかと思います。</p>\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-2\">コピー</span><code id=\"code-2\" class=\"php\">wp_enqueue_style( 'my-style', get_stylesheet_directory_uri() . '/style.css', array(), '1.0.0' );\r\nwp_enqueue_script( 'my-js', get_stylesheet_directory_uri() . '/js/my.js', array( 'jquery' ), '1.0.0', true );</code></pre>\n<p>該当のCSSに対して、バージョン部分を変更してあげます。上の例でいうと、<code>1.0.0</code>の部分を<code>1.0.1</code>とかに変更してあげてください。</p>\n<p>HTMLソースを見えてもらえれば分かりますが、<code>?ver=1.0.0</code>として出力してくれます。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-3\">コピー</span><code id=\"code-3\" class=\"html\">&lt;link rel='stylesheet' id='my-style-css'  href='https://haniwaman.com/wp-content/themes/haniwaman/style.css?ver=1.0.0' type='text/css' media='all' /&gt;\r\n&lt;script type='text/javascript' src='https://haniwaman.com/wp-content/themes/haniwaman/js/my.js?ver=1.0.0'&gt;&lt;/script&gt;</code></pre>\n<h2><span id=\"_HTML\">その２ HTMLに直書き</span></h2>\n<p>GETパラメーターを付与するのは結構面倒くさかったりします。functions.phpを扱うので少し神経も使いますし。</p>\n<p>WordPressの修正でわたしがよくやっているのが、HTMLに直接出力する方法です。CSSファイルを新たに読みにいかないので、HTMLファイルさえ読み込める状態なら間違いなくスタイルが反映されます。</p>\n<p>HTMLに直接出力は<code>&lt;head&gt;</code>内に<code>&lt;style&gt;</code>で囲って、以下のような感じでCSSを記載する方法です。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-4\">コピー</span><code id=\"code-4\" class=\"html\">&lt;head&gt;\r\n\t&lt;title&gt;&lt;/title&gt;\r\n\t&lt;meta charset=\"utf-8\"&gt;\r\n\t&lt;style&gt;\r\n\t\t/* ここに追加 */\r\n\t&lt;/style&gt;\r\n&lt;/head&gt;</code></pre>\n<h3><span id=\"WordPressCSS\">WordPressでは「追加CSS」に追加する</span></h3>\n<p>WordPressでは便利な機能があって、<br />\n外観 → カスタマイズ → 追加CSS に記載すれば、追加したデザインをリアルタイムで確認しながら作業できますし、保存すれば<code>&lt;style&gt;</code>に保存されるという優れものです。</p>\n<p>簡単なカスタマイズであれば、追加CSSに追加していくだけで十分な場合もあります。</p>\n<h2><span id=\"i\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome -->\n<p>ブラウザのキャッシュに依存させずにCSSの変更を確認してもうらう方法を２パターン紹介しました。</p>\n<p>軽微な修正なら「追加CSS」でも十分かもしれません。（人によって<code>style</code>タグでの出力に抵抗のある方もいるかもしれませんが。。）</p>\n<p><span class=\"filename\">style.css?ver=1.0.2</span>のようにGETパラメーターでバージョン情報を付与する方法はキャッシュを意識しなくて済むだけでなく、こちら側の管理も明確になるというメリットもあります。</p>\n<p>「キャッシュの削除お願いします」のやりとりに疲れている方は、どちらかの方法をお試しください！</p>\n","date":"May 27, 2018","categories":[{"name":"CSS","slug":"css"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"0b06e0b6-cae7-5d70-abe6-e46c1f8760cf"}}}