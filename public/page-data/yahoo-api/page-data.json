{"componentChunkName":"component---src-templates-post-js","path":"/yahoo-api/","result":{"data":{"wordpressPost":{"id":"deae39ff-c8c4-50c0-8263-3634951399ba","title":"Yahoo! APIの使い方！PHPのコードサンプルを付き","slug":"yahoo-api","content":"<p>Yahoo! APIの使い方を紹介します。<br />\n<a href=\"https://haniwaman.com/rakuten-api/\">楽天API</a>と使い方が似ていて簡単に使えるようになると思いますよ。</p>\n<p>Yahoo!が提供してくれているAPIってたくさんあるんですけど、今回はショッピングについてサンプルコードを書きました。<br />\nこれからYahoo! APIを勉強する人の手助けになれれば嬉しく思います。</p>\n<p>では早速、登録から行っていきましょう！</p>\n<div class=\"chat\"><figure class=\"chat-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"><figcaption>はにわまん</figcaption></figure><div class=\"chat-content\">Yahoo!のAPIもシンプルで使いやすいです！</div></div>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#i\"><span class=\"toc_number toc_depth_1\">1</span> アプリケーションの登録</a></li><li><a href=\"#YahooAPI\"><span class=\"toc_number toc_depth_1\">2</span> Yahoo!が提供しているAPI一覧</a></li><li><a href=\"#Yahoo\"><span class=\"toc_number toc_depth_1\">3</span> Yahoo!ショッピングから最安値の商品を見つけるサンプル</a><ul><li><a href=\"#i-2\"><span class=\"toc_number toc_depth_2\">3.1</span> 大雑把に解説</a></li></ul></li><li><a href=\"#i-3\"><span class=\"toc_number toc_depth_1\">4</span> おわり</a></li></ul></div>\n<h2><span id=\"i\">アプリケーションの登録</span></h2>\n<p>Yahoo! APIを利用するには、まずアプリケーションを登録する必要があります。</p>\n<p>Yahoo!デベロッパーにアクセス。<br />\n→<a href=\"http://developer.yahoo.co.jp/\" target=\"_blank\">Yahoo!デベロッパーネットワーク</a></p>\n<p>「アプリケショーンの管理」を選択します。<br />\nもしくは、<a href=\"https://e.developer.yahoo.co.jp/dashboard/\" target=\"_blank\">https://e.developer.yahoo.co.jp/dashboard/</a><br />\n<img class=\"alignnone size-full wp-image-7519\" src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api.png\" alt=\"yahoo_api\" width=\"614\" height=\"385\" /></p>\n<p>Yahoo!のアカウントでログインしてください。<br />\n（Yahoo!のアカウントを持っていない方は、まず取得してください。）<br />\n<img class=\"alignnone size-full wp-image-7520\" src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_2.png\" alt=\"yahoo_api_2\" width=\"643\" height=\"497\" /></p>\n<p>「新しいアプリケーションを開発」を選択します。<br />\n<img class=\"alignnone size-full wp-image-7521\" src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_3.png\" alt=\"yahoo_api_3\" width=\"653\" height=\"192\" /></p>\n<p>Yahoo! APIを利用するアプリケーションを選択します。<br />\n必須なのは、</p>\n<ul>\n<li>アプリケーションの種類</li>\n<li>連絡先メールアドレス</li>\n<li>アプリケーション名</li>\n<li>サイトURL</li>\n</ul>\n<p><img class=\"alignnone size-full wp-image-7522\" src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_4.png\" alt=\"yahoo_api_4\" width=\"700\" /><br />\n<img class=\"alignnone size-full wp-image-7522\" src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_4_2.png\" alt=\"yahoo_api_4_2\" width=\"700\" /></p>\n<p>PHPなどのサーバーサイドのプログラムを利用したWebサービスであれば、<br />\n「アプリケーションの種類」は「サーバーサイド」で大丈夫です。</p>\n<p>ガイドラインを読み、「同意」したら「確認」ボタンをクリックします。<br />\n記入した内容に問題なければ「登録」ボタンで登録完了です。</p>\n<p>Yahoo APIを利用するのに必要な「アプリケーションID」と「シークレット」が発行されます。<br />\n<img class=\"alignnone size-full wp-image-7523\" src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_5.png\" alt=\"yahoo_api_5\" width=\"500\" height=\"218\" /></p>\n<p>この情報はYahooデベロッパーの「<a href=\"https://e.developer.yahoo.co.jp/dashboard/\" target=\"_blank\">アプリケーションの管理</a>」から確認できるので特にメモしておく必要はないかと思います。</p>\n<h2><span id=\"YahooAPI\">Yahoo!が提供しているAPI一覧</span></h2>\n<p>その前にYahoo!が提供してくれているAPIの一覧を確認しておきましょう。<br />\n商品検索以外にも便利なAPIがあるので一通り目を通しておくといいかもしれません。</p>\n<p>→<a href=\"http://developer.yahoo.co.jp/sitemap/\" target=\"_blank\">http://developer.yahoo.co.jp/sitemap/</a><br />\n<img class=\"alignnone size-full wp-image-7524\" src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_6.png\" alt=\"yahoo_api_6\" width=\"965\" height=\"420\" /></p>\n<p>わたしがよく利用するのは、「ショッピング」「オークション」「テキスト解析」あたりですかね。<br />\n「テキスト解析」の形態素解析は日本語を分解するのにとても便利です。</p>\n<p>今回は、「ショッピング」のAPIを利用して、商品検索を行うサンプルプログラムを作っていきます！</p>\n<h2><span id=\"Yahoo\">Yahoo!ショッピングから最安値の商品を見つけるサンプル</span></h2>\n<p>Yahoo!ショッピングから任意のキーワードで検索した時に安い順で結果を返してもらうようなコードを書いていきます。</p>\n<p>商品検索に関するパラメーターなどの情報は以下から。<br />\n→<a href=\"http://developer.yahoo.co.jp/webapi/shopping/shopping/v1/itemsearch.html\" target=\"_blank\">http://developer.yahoo.co.jp/webapi/shopping/shopping/v1/itemsearch.html</a></p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"php\">\r\n&lt;!DOCTYPE html&gt;\r\n&lt;html lang=&#039;ja&#039;&gt;\r\n&lt;head&gt;\r\n&lt;title&gt;楽天商品検索API テスト&lt;/title&gt;\r\n&lt;meta charset=&#039;utf-8&#039;&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;?php\r\n\r\n$yahoo_relust = getYahooResult(&#039;進撃の巨人&#039;); // キーワードと最低価格を指定\r\nforeach ($yahoo_relust as $item) :\r\n?&gt;\r\n&lt;div style=&#039;margin-bottom: 20px; padding: 30px; border: 1px solid #000; overflow:hidden;&#039;&gt;\r\n&lt;div style=&#039;float: left;&#039;&gt;&lt;img src=&#039;&lt;?php echo $item[&#039;img&#039;]; ?&gt;&#039;&gt;&lt;/div&gt;\r\n&lt;div style=&#039;float: left; padding: 20px;&#039;&gt;\r\n&lt;div&gt;&lt;?php echo $item[&#039;name&#039;]; ?&gt;&lt;/div&gt;\r\n&lt;div&gt;&lt;a href=&#039;&lt;?php echo $item[&#039;url&#039;]; ?&gt;&#039; target=&quot;_blank&quot;&gt;&lt;?php echo $item[&#039;url&#039;]; ?&gt;&lt;/a&gt;&lt;/div&gt;\r\n&lt;div&gt;&lt;?php echo $item[&#039;price&#039;]; ?&gt;円&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;/div&gt;\r\n&lt;?php\r\nendforeach;\r\n?&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n\r\n&lt;?php\r\n\r\nfunction getYahooResult($keyword) {\r\n\r\n// リクエストURL\r\n$baseurl = &quot;http://shopping.yahooapis.jp/ShoppingWebService/V1/itemSearch&quot;; //XML\r\n// リクエストのパラメータ作成\r\n$params = array();\r\n$params[&quot;appid&quot;] = &quot;[自分のアプリケーションID]&quot;; // アプリケーションID\r\n$params[&quot;query&quot;] = urlencode_rfc3986($keyword);\r\n$params[&quot;sort&quot;] = urlencode_rfc3986(&quot;+price&quot;);\r\n\r\n// canonical string を作成\r\n$canonical_string = &quot;&quot;;\r\nforeach ($params as $k =&gt; $v) {\r\n$canonical_string .= &quot;&amp;&quot; . $k . &quot;=&quot; . $v;\r\n}\r\n// 先頭の&#039;&amp;&#039;を除去\r\n$canonical_string = substr($canonical_string, 1);\r\n\r\n// URL を作成\r\n$url = $baseurl . &quot;?&quot; . $canonical_string;\r\n\r\necho $url . &quot;&lt;br&gt;&quot;;\r\n\r\n// XMLをオブジェクトに代入\r\n$yahoo_xml = simplexml_load_string(@file_get_contents($url));\r\n\r\n$items = array();\r\nforeach($yahoo_xml-&gt;Result-&gt;Hit as $item){\r\n\r\n$items[] = array(\r\n&#039;name&#039; =&gt; (string)$item-&gt;Name,\r\n&#039;url&#039; =&gt; (string)$item-&gt;Url,\r\n&#039;img&#039; =&gt; (string)$item-&gt;Image-&gt;Medium,\r\n&#039;price&#039; =&gt; (string)$item-&gt;Price,\r\n);\r\n\r\n}\r\nreturn $items;\r\n}\r\n\r\n// RFC3986 形式で URL エンコードする関数\r\nfunction urlencode_rfc3986($str) {\r\nreturn str_replace(&quot;%7E&quot;, &quot;~&quot;, rawurlencode($str));\r\n}</code></pre>\n<p>35行目に自分のアプリケーションIDを入力してください。</p>\n<p>10行目の「進撃の巨人」は自分の好きなキーワードに変更してもらって構いません。</p>\n<p>実行すると以下のようになります。<br />\n<img class=\"alignnone size-full wp-image-7525\" src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_7.png\" alt=\"yahoo_api_7\" width=\"965\" height=\"718\" /></p>\n<h3><span id=\"i-2\">大雑把に解説</span></h3>\n<p>Yahoo!ショッピングでの商品検索APIは、<br />\nリクエストURLをYahoo!に投げて、結果を受け取るという流れになります。</p>\n<p>商品検索における、リクエストURLとは、以下のURLです。<br />\n→<a href=\"http://developer.yahoo.co.jp/webapi/shopping/shopping/v1/itemsearch.html\" target=\"_blank\">http://developer.yahoo.co.jp/webapi/shopping/shopping/v1/itemsearch.html</a><br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_8.png\" alt=\"yahoo_api_8\" width=\"718\" height=\"242\" class=\"alignnone size-full wp-image-7527\" /></p>\n<p>32行目で指定しています。</p>\n<p>これがベースとなるURLでここに「パラメーター」をつけていきます。<br />\nちょっとスクロールすると「リクエストパラメータ」という箇所があります。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2016/01/yahoo_api_9.png\" alt=\"yahoo_api_9\" width=\"725\" height=\"482\" class=\"alignnone size-full wp-image-7528\" /></p>\n<p>「リクエストURL」に「リクエストパラメーター」をくっつけることで、Yahooは結果を返してくれるようになります。<br />\n今回必須となる「リクエストパラメーター」は、「アプリケーションID」と「キーワード検索」でした。</p>\n<p>で、このパラメーターの付け方は、</p>\n<blockquote><p>http://「リクエストURL」?「パラメーター」=「値」&amp;「パラメーター」=「値」&amp;「パラメーター」=「値」&amp;・・・</p></blockquote>\n<p>といった形です。</p>\n<p>このリクエストURLとパラメーターをくっつける処理を31行目から50行目で行っています。<br />\n50行目で<code>echo $url</code>で作成したURLを表示させたのでどんな風にできあがるか見てみてください。</p>\n<p>こいつをYahooに投げれば結果を返してくれます。<br />\nただ、いろんな結果が返ってくるので、こちらで表示させたいやつだけ抜き出してやる必要があります。</p>\n<p>その処理が、52行目から65行目です。<br />\nリクエストURLで「XML」を選んだので結果はxmlの形式で返ってきます。</p>\n<p>そのxmlのデータをphpが読み込めるような形に変え、「名前」「URL」「画像」「価格」だけ取得する処理をしています。<br />\n<code>$yahoo_xml</code>が編集する前の結果そのものなので、より理解したい方は中身を覗くといいと思います。<br />\n（<code>ver_dump($yahoo_xml)</code>などで。）</p>\n<p>そして最後に、HTMLとCSSで整形して出力しているといった流れです。</p>\n<h2><span id=\"i-3\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome -->\n<p>駆け足で説明しましたが、なんとなく理解できたでしょうか？</p>\n<p>YahooのAPIは他のWeb APIに比べるとマニュアルがしっかりしていて、<a href=\"http://developer.yahoo.co.jp/webapi/shopping/\" target=\"_blank\">公式のガイダンス</a>をちゃんと読めば理解できると思います。<br />\n（AmazonとかTwitterとかは基本的に英語でしか説明してくれない・・・）</p>\n<p>最後に、Yahoo公式のPHPサンプル見つけたので貼り付けておきます。<br />\n（コード書き終わってから気づきました・・・笑）<br />\n→<a href=\"http://developer.yahoo.co.jp/sample/shopping/sample1.html\" target=\"_blank\">http://developer.yahoo.co.jp/sample/shopping/sample1.html</a></p>\n","date":"December 24, 2017","categories":[{"name":"Web API","slug":"web-api"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"deae39ff-c8c4-50c0-8263-3634951399ba"}}}