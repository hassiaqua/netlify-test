{"componentChunkName":"component---src-templates-post-js","path":"/amazon-api-5/","result":{"data":{"wordpressPost":{"id":"29c259cf-7864-5471-8d96-285c282c94ac","title":"「Amazon API」の使い方⑤－リクエスト結果（XML）の表示編－","slug":"amazon-api-5","content":"<div class=\"box box-link\">\n※ 本エントリーは、PA-API4.0時点のものとなります。<strong class=\"marker\">2019年12月1日から新しいバージョン5.0のPA-API（Product Advertising API）と移行</strong>するため、これからPA-APIをご利用の方は、以下のv5.0の記事をご参考ください。</p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"EgmCIjzD9g\"><p><a href=\"https://haniwaman.com/pa-api-5/\">4.0から大きく変わった「PA-API v5.0」の使い方！</a></p></blockquote>\n<p><iframe title=\"&#8220;4.0から大きく変わった「PA-API v5.0」の使い方！&#8221; &#8212; HPcode\" class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"https://haniwaman.com/pa-api-5/embed/#?secret=EgmCIjzD9g\" data-secret=\"EgmCIjzD9g\" width=\"500\" height=\"282\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe>\n</div>\n<p>前回で、<br />\nリクエストURLを作成して結果を受け取ることができるようになりました。<br />\n（→ <a href=\"https://haniwaman.com/amazon-api-4/\">リクエストURLの作成（PHP）と結果（XML）の確認</a>）</p>\n<p>今回は、取得した結果（XML）から値を取得してHTML形式で表示させます。</p>\n<div class=\"chat\"><figure class=\"chat-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"><figcaption>はにわまん</figcaption></figure><div class=\"chat-content\">XMLを解析してプログラムで利用できるようにすることをパースと呼んだりします</div></div>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#XML\"><span class=\"toc_number toc_depth_1\">1</span> リクエスト結果（XML）の表示</a><ul><li><a href=\"#1file_get_contentsURL\"><span class=\"toc_number toc_depth_2\">1.1</span> 1行目の「file_get_contents」の引数にリクエストURLを入れる</a></li></ul></li><li><a href=\"#XML-2\"><span class=\"toc_number toc_depth_1\">2</span> 簡単にXMLの読み方の説明</a></li><li><a href=\"#i\"><span class=\"toc_number toc_depth_1\">3</span> おわり</a></li></ul></div>\n<h2><span id=\"XML\">リクエスト結果（XML）の表示</span></h2>\n<p>XMLから値を取得するのも、PHPには関数が用意されているので、<br />\nそれを使えば簡単に行うことができます。</p>\n<p>「<code>simplexml_load_string()</code>」という関数ですね。<br />\nでは、早速コードを見ていきましょう。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"php\">$amazon_xml = simplexml_load_string( file_get_contents( *********** ) );\r\nforeach( $amazon_xml-&gt;Items-&gt;Item as $item ) {\r\n\techo \"&lt;ul&gt;\";\r\n\t/* 商品名 */\r\n\tif ( ! empty( $item-&gt;ItemAttributes-&gt;Title ) ) echo \"&lt;li&gt;\" . $item-&gt;ItemAttributes-&gt;Title . \"&lt;/li&gt;\";\r\n\t/* 商品のURL */\r\n\tif ( ! empty( $item-&gt;DetailPageURL ) ) echo \"&lt;li&gt;&lt;a href=\\\"\" . $item-&gt;DetailPageURL . \"\\\" target=\\\"_blank\\\"&gt;\" . $item-&gt;DetailPageURL . \"&lt;/a&gt;&lt;/li&gt;\";\r\n\techo \"&lt;/ul&gt;\";\r\n}\r\n</code></pre>\n<h3><span id=\"1file_get_contentsURL\">1行目の「file_get_contents」の引数にリクエストURLを入れる</span></h3>\n<p>1行目のアスタリスク（*）の部分にリクエストURLを入力してください。<br />\n前回（⇒<a href=\"https://haniwaman.com/amazon-api-4/\">リクエストURLの作成（PHP）と結果（XML）の確認</a>）作成したリクエストURLを入れてみましょう。</p>\n<p>前回のと組み合わせるのであれば、「$base_request」を引数として入れてあげてください。前回のソースの一番下にそのまま入れてあげると動くはずです。</p>\n<p>実行してみると、以下のような表示になります。<br />\n<img class=\"alignnone wp-image-6284\" src=\"https://haniwaman.com/wp-content/uploads/2014/09/amazon_api_27.png\" alt=\"amazon_api_27\" width=\"469\" height=\"336\" /></p>\n<p>表示形式は、XMLから取得した値をHTMLのタグに入れているだけなので、好きな形に変えることができます。</p>\n<h2><span id=\"XML-2\">簡単にXMLの読み方の説明</span></h2>\n<p>たぶん初めて見た人には、1行目から6行目が分かりにくいかと思うので、ちょっとだけ説明します。<br />\n（イメージレベルですが。。。）</p>\n<p>1行目でXMLの全体のオブジェクトを取得しているイメージ。<br />\n（ルート階層を持っているイメージ？）</p>\n<p>2行目の「$amazon_xml-&gt;Items-&gt;Item」が何を指しているかと言うと、ルート（「ItemSearchResponse」）階層の子階層の「Items」。<br />\n「Items」階層の子階層の「Item」を指しています。<br />\n<img class=\"alignnone wp-image-6286\" src=\"https://haniwaman.com/wp-content/uploads/2014/09/amazon_api_28.png\" alt=\"amazon_api_28\" width=\"441\" height=\"591\" /></p>\n<p>数えてもらうと分かりますが、パラメーターで指定しない限りは、「Item」はデフォルトで10個あります。</p>\n<p>これらを全部読み込ますために<code>foreach</code>で回してあげてるんですね。</p>\n<p>ループの中では各「Item」のさらに下の階層から値を取得している感じです。</p>\n<p>例えば、4行目の「$item-&gt;ItemAttributes-&gt;Title」であれば、「Item」の子階層の「ItemAttributes」の子階層の「Title」の値を取得しています。</p>\n<p>今回は商品名、商品URL、価格の3つの値だけを取得していますが、XMLに書かれている情報は、上で説明したのと同じようにすれば取得できるので、欲しいデータがあれば、ガンガン取得しちゃいましょう。<br />\n<h2><span id=\"i\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome --><br />\nリクエスト結果（XML）の表示についてでした。<br />\nXMLのソースと見比べながらやれば、そんなに難しくないとは思います。</p>\n<p>次回は、リクエストURLを送る際のパラメーターについて紹介していきます。</p>\n<p>Amazonから取得した情報を内容を色々と設定することができます。<br />\n今のままだと画像とか取得できてないですからね・・・。</p>\n<div class=\"box box-link\">\n※ 以下エントリーは、PA-API4.0時点のものとなります。<strong class=\"marker\">2019年12月1日から新しいバージョン5.0のPA-API（Product Advertising API）と移行</strong>するため、これからPA-APIをご利用の方は、以下のv5.0の記事をご参考ください。</p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"EgmCIjzD9g\"><p><a href=\"https://haniwaman.com/pa-api-5/\">4.0から大きく変わった「PA-API v5.0」の使い方！</a></p></blockquote>\n<p><iframe title=\"&#8220;4.0から大きく変わった「PA-API v5.0」の使い方！&#8221; &#8212; HPcode\" class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"https://haniwaman.com/pa-api-5/embed/#?secret=EgmCIjzD9g\" data-secret=\"EgmCIjzD9g\" width=\"500\" height=\"282\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe>\n</div>\n<p>第1回：<a href=\"https://haniwaman.com/amazon-api-1/\">アソシエイトタグの取得</a><br />\n第2回：<a href=\"https://haniwaman.com/amazon-api-2/\">アクセスキーとシークレットキーの取得</a><br />\n第3回：<a href=\"https://haniwaman.com/amazon-api-3/\">リクエストURL作成の概要</a><br />\n第4回：<a href=\"https://haniwaman.com/amazon-api-4/\">リクエストURLの作成（PHP）と結果（XML）の確認</a><br />\n第5回：<a href=\"https://haniwaman.com/amazon-api-5/\">リクエスト結果（XML）の表示</a><br />\n第6回：<a href=\"https://haniwaman.com/amazon-api-6/\">パラメーターの種類とか</a><br />\n最終回：<a href=\"https://haniwaman.com/amazon-api-7/\">実際に作ってみよう</a></p>\n","date":"December 24, 2017","categories":[{"name":"Web API","slug":"web-api"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"29c259cf-7864-5471-8d96-285c282c94ac"}}}