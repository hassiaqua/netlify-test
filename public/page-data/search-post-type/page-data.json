{"componentChunkName":"component---src-templates-post-js","path":"/search-post-type/","result":{"data":{"wordpressPost":{"id":"6d483679-1ff2-563f-bc09-c7c49392cc2b","title":"WordPressのサイト内検索を投稿タイプごとに限定させる方法","slug":"search-post-type","content":"<p>カスタム投稿タイプを作るのは、役割を明確に区別したいからです。しかし、WordPressのサイト内検索をすると、カスタム投稿タイプをすべて横断して検索してしまいます。</p>\n<p>当サイト「HPcode」で言うと、<a href=\"https://haniwaman.com/blog/\">ブログの記事</a>と<a href=\"https://haniwaman.com/parts/\">パーツ集</a>の<strong class=\"marker\">記事がごっちゃになってしまうため、雑音入りまくりで目当ての情報をすぐに見つけられません</strong>。</p>\n<p>個人的には、WordPressのサイト内検索は投稿タイプごとに区別して結果を返して欲しいと思っているので、今回はその方法を紹介していきます！</p>\n<div class=\"chat\"><figure class=\"chat-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"><figcaption>はにわまん</figcaption></figure><div class=\"chat-content\">WP_Queryの概念が分かっていれば、すぐに実装できると思います！</div></div>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#i\"><span class=\"toc_number toc_depth_1\">1</span> サイト内検索を投稿タイプごとに限定させる方法</a><ul><li><a href=\"#searchformphp\"><span class=\"toc_number toc_depth_2\">1.1</span> searchform.php</a></li><li><a href=\"#searchphp\"><span class=\"toc_number toc_depth_2\">1.2</span> search.php</a></li></ul></li><li><a href=\"#i-2\"><span class=\"toc_number toc_depth_1\">2</span> おわり</a></li></ul></div>\n<h2><span id=\"i\">サイト内検索を投稿タイプごとに限定させる方法</span></h2>\n<p>修正するテンプレートファイルは検索に関する以下の2点です。</p>\n<ul>\n<li><span class=\"folder\">searchform.php</span></li>\n<li><span class=\"folder\">search.php</span></li>\n</ul>\n<p>それぞれのカスタマイズ方法を順番に見ていきましょう！</p>\n<h3><span id=\"searchformphp\"><span class=\"folder\">searchform.php</span></span></h3>\n<p>検索フォームから投稿タイプの情報を渡してあげる必要があります。これはWordPressの仕組みではありません。HTMLのフォームの仕様を理解していれば、思いつく内容かと思います。</p>\n<p>具体的には以下の1行をフォーム内に追加してください。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"html\">&lt;input type=\"hidden\" value=\"&lt;?php echo get_post_type(); ?&gt;\" name=\"post_type\" id=\"post_type\" /&gt;\r\n</code></pre>\n<p>全体像はこんな感じです。ここの記述方法はテーマによって異なると思いますが、上記の1行をフォーム内に追記すると覚えておいてください。</p>\n<pre><span class=\"folder\">searchform.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-1\">コピー</span><code id=\"code-1\" class=\"html\">&lt;form role=\"search\" method=\"get\" id=\"searchform\" class=\"search-form\" action=\"&lt;?php echo esc_url( home_url( '/' ) ); ?&gt;\"&gt;\r\n\t&lt;div&gt;\r\n\t\t&lt;label class=\"screen-reader-text\" for=\"s\"&gt;&lt;?php _x( 'Search for:', 'label' ); ?&gt;&lt;/label&gt;\r\n\t\t&lt;input type=\"search\" class=\"search-field\" value=\"&lt;?php echo get_search_query(); ?&gt;\" placeholder=\"サイト内検索 …\" name=\"s\" id=\"s\" /&gt;\r\n\t\t&lt;input type=\"hidden\" value=\"&lt;?php echo get_post_type(); ?&gt;\" name=\"post_type\" id=\"post_type\" /&gt;\r\n\t\t&lt;input type=\"submit\" class=\"search-submit\" value=\"&amp;#xf002\" /&gt;\r\n\t&lt;/div&gt;\r\n&lt;/form&gt;</code></pre>\n<h3><span id=\"searchphp\"><span class=\"folder\">search.php</span></span></h3>\n<p>検索結果を表示するための<span class=\"folder\">search.php</span>をカスタマイズしていきます。</p>\n<p>先程フォームに設定した投稿タイプを取得してループを回すといった流れですね。</p>\n<pre><span class=\"folder\">search.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-2\">コピー</span><code id=\"code-2\" class=\"php\">$search_query = new WP_Query( array( 'post_type' =&gt; get_query_var( 'post_type', 'post' ), 'paged' =&gt; get_query_var( 'paged', 1 ), 's' =&gt; get_search_query() ) );\r\nif ( $search_query-&gt;have_posts() ) {\r\n\twhile ( $search_query-&gt;have_posts() ) {\r\n\t\t$search_query-&gt;the_post();\r\n\t\t/* ループ内で表示させる処理 */\r\n\t}\r\n}\r\nwp_reset_postdata();</code></pre>\n<p>参考：<a href=\"https://wpdocs.osdn.jp/%E9%96%A2%E6%95%B0%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9/WP_Query\" rel=\"noopener\" target=\"_blank\">関数リファレンス/WP Query</a></p>\n<p><code>get_query_var( 'post_type', 'post' )</code>で、<span class=\"folder\">searchform.php</span>にて設定された投稿タイプを取得しています。&#8217;post_type&#8217;が設定されていれば、そのカスタム投稿タイプ内のループを回し、設定されていなければ、通常の投稿のループを回すといった処理です。</p>\n<h2><span id=\"i-2\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome -->\n<p>WordPressのサイト内検索を投稿タイプごとに限定させる方法でした。</p>\n<p>HTMLのフォームの仕組みと、<code>WP_Query</code>の概念が分かっていれば、すぐに実装できると思います。投稿タイプが乱立している方は、ぜひお試しください！</p>\n","date":"March 15, 2018","categories":[{"name":"WordPress","slug":"wordpress"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"6d483679-1ff2-563f-bc09-c7c49392cc2b"}}}