{"componentChunkName":"component---src-templates-post-js","path":"/oembed/","result":{"data":{"wordpressPost":{"id":"f609f6fe-2b5a-5492-b687-2bc8be2ac01f","title":"URLを貼り付けるだけで埋め込まれるWordPress内部リンク（oEmbed）をカスタマイズする方法","slug":"oembed","content":"<p>WordPress4.4から、oEmbed対応の記事だったらURLを貼るだけで埋め込み表示されるようになりました。</p>\n<blockquote><p>他の WordPress サイトに投稿を埋め込めるようになりました。エディターに投稿の URL を入れるだけで、設定したタイトル、抜粋、アイキャッチ画像を備えた埋め込みプレビューがすぐに表示されます。さらに、サイトアイコンやコメント・共有用リンクも含まれます。</p>\n<p><a href=\"https://ja.wordpress.org/2015/12/10/clifford/\" rel=\"noopener\" target=\"_blank\">WordPress 4.4 “Clifford”</a></p></blockquote>\n<p>初期表示だとこんな感じ。※ 画像です。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2018/05/oembed.png\" alt=\"\" width=\"625\" height=\"603\" class=\"alignnone size-full wp-image-6104\" /></p>\n<p>めちゃくちゃデカイですね。</p>\n<ul>\n<li>アイキャッチ</li>\n<li>タイトル</li>\n<li>抜粋</li>\n<li>ロゴ</li>\n<li>サイト名</li>\n<li>コメント数</li>\n<li>共有ボタン</li>\n</ul>\n<p>めっちゃ便利な機能ではあるのですが、ちょっと場所を取りすぎです。そこで、この記事に埋め込まれるoEmbedの表示をカスタマイズしていく方法を紹介していきます！</p>\n<div class=\"chat\"><figure class=\"chat-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"><figcaption>はにわまん</figcaption></figure><div class=\"chat-content\">URLを貼るだけで埋め込んでくれるoEmbed機能はマジで神です！</div></div>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#i\"><span class=\"toc_number toc_depth_1\">1</span> 既存の機能を活かした「プチ」カスタマイズ</a><ul><li><a href=\"#i-2\"><span class=\"toc_number toc_depth_2\">1.1</span> 画像のサイズを変更</a></li><li><a href=\"#i-3\"><span class=\"toc_number toc_depth_2\">1.2</span> 画像の表示位置を変更</a></li><li><a href=\"#i-4\"><span class=\"toc_number toc_depth_2\">1.3</span> 埋め込み処理の実体</a></li></ul></li><li><a href=\"#i-5\"><span class=\"toc_number toc_depth_1\">2</span> 中身をまるごと変えるカスタマイズ</a><ul><li><a href=\"#i-6\"><span class=\"toc_number toc_depth_2\">2.1</span> 埋め込みテンプレートを独自に作る</a></li><li><a href=\"#CSS\"><span class=\"toc_number toc_depth_2\">2.2</span> 埋め込み用のCSSを削除する</a></li><li><a href=\"#CSS-2\"><span class=\"toc_number toc_depth_2\">2.3</span> 埋め込み用のCSSを追加する</a></li></ul></li><li><a href=\"#i-7\"><span class=\"toc_number toc_depth_1\">3</span> 埋め込み記事をさせたくない</a></li><li><a href=\"#i-8\"><span class=\"toc_number toc_depth_1\">4</span> おわり</a></li></ul></div>\n<h2><span id=\"i\">既存の機能を活かした「プチ」カスタマイズ</span></h2>\n<p>まずは、既存の埋め込みを活かしたカスタマイズ方法から。フィルターフックやアクションフックで決められた部分しか変更できないので、かなり限定的です。</p>\n<p>ゴッソリ変えたい人は飛ばして<a href=\"#all\">中身をまるごと変えるカスタマイズ</a>から見てください。</p>\n<h3><span id=\"i-2\">画像のサイズを変更</span></h3>\n<p><code>return</code>で「画像のサイズ」を指定してあげてください！</p>\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"php\">function set_thumbnail_size() {\r\n\treturn 'thumbnail';\r\n}\r\nadd_filter( 'embed_thumbnail_image_size', 'set_thumbnail_size' );</code></pre>\n<p>以下の値はちゃんと反応してくれましたので、どれか選ぶといいでしょう。</p>\n<ul>\n<li>thumbnail</li>\n<li>medium</li>\n<li>large</li>\n<li>full</li>\n</ul>\n<h3><span id=\"i-3\">画像の表示位置を変更</span></h3>\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-1\">コピー</span><code id=\"code-1\" class=\"php\">function set_thumbnail_image_shape() {\r\n\treturn 'square';\r\n}\r\nadd_filter( 'embed_thumbnail_image_shape', 'set_thumbnail_image_shape' );</code></pre>\n<ul>\n<li>rectangular ・・・ 縦並び</li>\n<li>square ・・・ 横並び</li>\n</ul>\n<h3><span id=\"i-4\">埋め込み処理の実体</span></h3>\n<p>実際に埋め込ませるコードを作っているファイルは、</p>\n<p><span class=\"filename\">/wp-includes/theme-compat/embed-content.php</span></p>\n<p>になります。</p>\n<p><code>do_action</code>や<code>add_filter</code>がいろいろと組み込まれています。<br />\n何が使えるか中身を「チラッ」とみてみると理解が深まるかもしれません。</p>\n<h2 id=\"all\"><span id=\"i-5\">中身をまるごと変えるカスタマイズ</span></h2>\n<h3><span id=\"i-6\">埋め込みテンプレートを独自に作る</span></h3>\n<p>埋め込み時のテンプレートはデフォルトでは、<span class=\"filename\">wp-includes/embed-template.php</span>が読み込まれています。</p>\n<p>独自のテンプレートに変更したい場合は、テーマフォルダに<span class=\"filename\">embed.php</span>を設置することで変更が可能になります。<br />\n<!-- \n\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-2\">コピー</span><code id=\"code-2\" class=\"php\">function my_embed_template( $template ) {\r\n\t$template = get_stylesheet_directory() . '/embed-template.php';\r\n\treturn $template;\r\n}\r\nadd_filter( 'embed_template', 'my_embed_template' );</code></pre>\n\n --></p>\n<p><span class=\"filename\">embed.php</span>に記載する内容は、<span class=\"filename\">wp-includes/embed-template.php</span>を読み解きながら書いていってほしいのですが、わたしか以下のように書いています。（アイキャッチとタイトル出すだけのシンプルなもの）</p>\n<pre><span class=\"filename\">embed.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-3\">コピー</span><code id=\"code-3\" class=\"php\">&lt;?php\r\nif ( ! headers_sent() ) {\r\n\theader( 'X-WP-embed: true' );\r\n}\r\n?&gt;\r\n&lt;!DOCTYPE html&gt;\r\n&lt;html &lt;?php language_attributes(); ?&gt; class=\"no-js\"&gt;\r\n&lt;head&gt;\r\n\t&lt;title&gt;&lt;?php echo wp_get_document_title(); ?&gt;&lt;/title&gt;\r\n\t&lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt;\r\n\t&lt;?php do_action( 'embed_head' ); ?&gt;\r\n&lt;/head&gt;\r\n&lt;body &lt;?php body_class(); ?&gt;&gt;\r\n\r\n&lt;?php \r\nif ( have_posts() ) :\r\n\twhile ( have_posts() ) : the_post();\r\n?&gt;\r\n&lt;a href=\"&lt;?php the_permalink(); ?&gt;\" &lt;?php post_class( 'wp-embed' ); ?&gt;&gt;\r\n\t&lt;?php\r\n\t$thumbnail_id = 0;\r\n\tif ( has_post_thumbnail() ) {\r\n\t\t$thumbnail_id = get_post_thumbnail_id();\r\n\t}\r\n\tif ( 'attachment' === get_post_type() &amp;&amp; wp_attachment_is_image() ) {\r\n\t\t$thumbnail_id = get_the_ID();\r\n\t}\r\n\t$image_size = 'thumbnail';\r\n\t?&gt;\r\n\t&lt;div class=\"wp-embed-featured-image\"&gt;\r\n\t\t&lt;?php echo wp_get_attachment_image( $thumbnail_id, $image_size ); ?&gt;\r\n\t&lt;/div&gt;\r\n\t&lt;div class=\"wp-embed-heading\"&gt;&lt;?php the_title(); ?&gt;&lt;/div&gt;\r\n&lt;/a&gt;\r\n&lt;?php\r\n\tendwhile;\r\nendif;\r\ndo_action( 'embed_footer' );\r\n?&gt;</code></pre>\n<p>デフォルトのCSSを解除した状態であれば、以下のような要素が読み込まれています。</p>\n<h3><span id=\"CSS\">埋め込み用のCSSを削除する</span></h3>\n<p>読み込み用のCSSも変更できます。</p>\n<p>まずは、デフォルトで読み込まれているCSSを解除します。</p>\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-4\">コピー</span><code id=\"code-4\" class=\"php\">remove_action( 'embed_head', 'print_embed_styles' );</code></pre>\n<p>解除した状態の見栄えはこんな感じ。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2018/05/oembed3-700x589.png\" alt=\"\" width=\"700\" height=\"589\" class=\"alignnone size-medium wp-image-6125\" srcset=\"https://haniwaman.com/wp-content/uploads/2018/05/oembed3-700x589.png 700w, https://haniwaman.com/wp-content/uploads/2018/05/oembed3-768x646.png 768w, https://haniwaman.com/wp-content/uploads/2018/05/oembed3.png 834w\" sizes=\"(max-width: 700px) 100vw, 700px\" /><br />\n「コピーして～」の部分が邪魔ですね。。</p>\n<h4>「コピーして埋め込み」を削除する</h4>\n<p>邪魔な部分は、<code>do_action( 'embed_footer' );</code>で読み込まれているところです。</p>\n<p>必要なものもあれば、「コピーしてうんぬん」みたいに不要な部分もあるので、見極めつつ削除していきます。今回のコピーしては<code>print_embed_sharing_dialog</code>を無効化すれば削除できます。</p>\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-5\">コピー</span><code id=\"code-5\" class=\"php\">remove_action( 'embed_footer', 'print_embed_sharing_dialog' );\r\n</code></pre>\n<p>消えました！<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2018/05/oembed4-700x268.png\" alt=\"\" width=\"700\" height=\"268\" class=\"alignnone size-medium wp-image-6127\" srcset=\"https://haniwaman.com/wp-content/uploads/2018/05/oembed4-700x268.png 700w, https://haniwaman.com/wp-content/uploads/2018/05/oembed4-768x294.png 768w, https://haniwaman.com/wp-content/uploads/2018/05/oembed4.png 838w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<h3><span id=\"CSS-2\">埋め込み用のCSSを追加する</span></h3>\n<p>そして、新しく読み込むCSSファイルを追加するために以下のように指定します。</p>\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-6\">コピー</span><code id=\"code-6\" class=\"php\">function my_embed_styles() {\r\n\twp_enqueue_style( 'wp-oembed-embed', '/wp-content/themes/haniwaman/css/wp-oembed-embed.css' );\r\n}\r\nadd_action( 'embed_head', 'my_embed_styles' );\r\n</code></pre>\n<p>読み込み方に癖があって、何故かサイト名までは自動で反映されるっぽいです。<br />\nわたしのサイトでいうと、https://haniwaman.com/までの記載は不要で、その続きからCSSファイルまでのパスを指定してあげる必要があります。</p>\n<p>以下のようなCSSを記述するとこんな見栄えになります。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2018/05/oembed2-700x146.png\" alt=\"\" width=\"700\" height=\"146\" class=\"alignnone size-medium wp-image-6124\" srcset=\"https://haniwaman.com/wp-content/uploads/2018/05/oembed2-700x146.png 700w, https://haniwaman.com/wp-content/uploads/2018/05/oembed2-768x160.png 768w, https://haniwaman.com/wp-content/uploads/2018/05/oembed2.png 838w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<pre><span class=\"filename\">wp-oembed-embed.css</span><span class=\"code-copy\" data-clipboard-target=\"#code-7\">コピー</span><code id=\"code-7\" class=\"css\">.wp-embed {\r\n\tdisplay: table;\r\n\ttext-decoration: none;\r\n\tcolor: #404040;\r\n\toverflow: hidden;\r\n\tborder-radius: 2px;\r\n\tbox-shadow: 0 0 5px 1px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.wp-embed-featured-image {\r\n\tdisplay: table-cell;\r\n\twidth: 100px;\r\n}\r\n\r\n.wp-embed-featured-image img {\r\n\tvertical-align: bottom;\r\n\twidth: 100px;\r\n\tmax-width: 100%;\r\n\theight: auto;\r\n}\r\n\r\n.wp-embed-heading {\r\n\tdisplay: table-cell;\r\n\tvertical-align: middle;\r\n\tpadding: 8px;\r\n}</code></pre>\n<p>さらにその上から<code>iframe</code>で囲まれています。こちらは、テーマ内で読み込まれている<span class=\"filename\">style.css</span>などのファイルから指定します。</p>\n<pre><span class=\"filename\">style.css</span><span class=\"code-copy\" data-clipboard-target=\"#code-8\">コピー</span><code id=\"code-8\" class=\"css\">.wp-embedded-content {\r\n\twidth: 100%;\r\n\tmax-width: 100%;\r\n\theight: 100px;\r\n}</code></pre>\n<p>こんな感じで埋め込み用のテンプレートを独自に作って、独自のCSSを適応して、カスタマイズしていくことも可能です。</p>\n<h2><span id=\"i-7\">埋め込み記事をさせたくない</span></h2>\n<p>埋め込みの記事が表示したい場合は、<code>wp_oembed_add_host_js</code>を停止させることで読み込みが停止されます。</p>\n<p><span class=\"filename\">wp-embed.min.js</span>が停止されてるので、自分のサイトでも他人のサイトでも埋め込まれなくなります。</p>\n<pre><span class=\"filename\">functions.php</span><span class=\"code-copy\" data-clipboard-target=\"#code-9\">コピー</span><code id=\"code-9\" class=\"php\">remove_action( 'wp_head', 'wp_oembed_add_host_js' );\r\n</code></pre>\n<h2><span id=\"i-8\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome -->\n<p>URLを貼り付けるだけで表示されるWordPress内部リンクをカスタマイズする方法でした。URLを貼り付けるだけでリンク化できるのでとても楽ですね。</p>\n<p><span class=\"filename\">embed.php</span>をカスタマイズして好みの内部リンクを作成してみてください！</p>\n","date":"May 15, 2018","categories":[{"name":"WordPress","slug":"wordpress"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"f609f6fe-2b5a-5492-b687-2bc8be2ac01f"}}}