{"componentChunkName":"component---src-templates-post-js","path":"/amazon-api-3/","result":{"data":{"wordpressPost":{"id":"f1f6bac3-6cdc-50fa-8935-55a25c895db4","title":"「Amazon API」の使い方！③－リクエストURL作成の概要編－","slug":"amazon-api-3","content":"<div class=\"box box-link\">\n※ 本エントリーは、PA-API4.0時点のものとなります。<strong class=\"marker\">2019年12月1日から新しいバージョン5.0のPA-API（Product Advertising API）と移行</strong>するため、これからPA-APIをご利用の方は、以下のv5.0の記事をご参考ください。</p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"ucgPo4gSbh\"><p><a href=\"https://haniwaman.com/pa-api-5/\">4.0から大きく変わった「PA-API v5.0」の使い方！</a></p></blockquote>\n<p><iframe title=\"&#8220;4.0から大きく変わった「PA-API v5.0」の使い方！&#8221; &#8212; HPcode\" class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"https://haniwaman.com/pa-api-5/embed/#?secret=ucgPo4gSbh\" data-secret=\"ucgPo4gSbh\" width=\"500\" height=\"282\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe>\n</div>\n<p>前回までで、</p>\n<ul>\n<li>アソシエイトタグ</li>\n<li>アクセスキー</li>\n<li>シークレットキー</li>\n</ul>\n<p>を取得することができました。</p>\n<p>第1回：<a href=\"https://haniwaman.com/amazon-api-1/\">アソシエイトタグの取得</a><br />\n第2回：<a href=\"https://haniwaman.com/amazon-api-2/\">アクセスキーとシークレットキーの取得</a></p>\n<p>この3つの値があれば、Amazonへリクエストを送り、<br />\n結果を受け取ることができるようになります。</p>\n<p>ただ、ここが結構面倒なんですよね。<br />\n今回は、まずは概要だけを紹介していきます。</p>\n<div class=\"chat\"><figure class=\"chat-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"><figcaption>はにわまん</figcaption></figure><div class=\"chat-content\">Amazon APIは複雑なので、概要から理解した方が結果的に早いかもしれません</div></div>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#Amazon\"><span class=\"toc_number toc_depth_1\">1</span> Amazonへ送るリクエストって？</a></li><li><a href=\"#URL\"><span class=\"toc_number toc_depth_1\">2</span> リクエストURL作成の概要</a><ul><li><a href=\"#i\"><span class=\"toc_number toc_depth_2\">2.1</span> ０．元となるリクエスト</a></li><li><a href=\"#i-2\"><span class=\"toc_number toc_depth_2\">2.2</span> １．タイムスタンプを付ける</a></li><li><a href=\"#RFC_3986\"><span class=\"toc_number toc_depth_2\">2.3</span> ２．「RFC 3986」形式でパラメーターの値をエンコーディング</a></li><li><a href=\"#i-3\"><span class=\"toc_number toc_depth_2\">2.4</span> ３．「&amp;」とか消して改行</a></li><li><a href=\"#i-4\"><span class=\"toc_number toc_depth_2\">2.5</span> ４．パラメーター名で昇順ソート</a></li><li><a href=\"#i-5\"><span class=\"toc_number toc_depth_2\">2.6</span> ５．もう一度「&amp;」でつなぐ</a></li><li><a href=\"#3\"><span class=\"toc_number toc_depth_2\">2.7</span> ６．3行を頭に追加</a></li><li><a href=\"#i-6\"><span class=\"toc_number toc_depth_2\">2.8</span> ７．よく分からんエンコーディング</a></li><li><a href=\"#Signature\"><span class=\"toc_number toc_depth_2\">2.9</span> ８．「Signature」として最後に追加</a></li></ul></li><li><a href=\"#URLURL\"><span class=\"toc_number toc_depth_1\">3</span> この手順で作られたURLがリクエストURL</a></li><li><a href=\"#i-7\"><span class=\"toc_number toc_depth_1\">4</span> おわり</a></li></ul></div>\n<h2><span id=\"Amazon\">Amazonへ送るリクエストって？</span></h2>\n<p>Amazon APIを利用したプログラムの仕組みはシンプルで、</p>\n<p>「○○の情報の結果が欲しい」とAmazonにお願いすると、<br />\nAmazonからXML形式で結果を返してくれるといったものです。</p>\n<p>雑な図ですが、イメージとしてはこんな感じです。<br />\n<img class=\"alignnone wp-image-6250\" src=\"https://haniwaman.com/wp-content/uploads/2014/09/amazon_api_21.png\" alt=\"amazon_api_21\" width=\"503\" height=\"263\" /></p>\n<p>リクエストは、GET形式のURLで色々なパラメーターを付けて送ります。</p>\n<p>例えば、以下のような感じです。（Amazonのサンプル）</p>\n<blockquote><p>http://webservices.amazon.com/onca/xml?Service=AWSECommerceService&amp;AWSAccessKeyId=AKIAIOSFODNN7EXAMPLE&amp;Operation=ItemLookup&amp;ItemId=0679722769&amp;ResponseGroup=ItemAttributes,Offers,Images,Reviews&amp;Version=2009-01-06</p></blockquote>\n<ul>\n<li>サービス名とか、</li>\n<li>アクセスキーとか、</li>\n<li>検索の方法とか、</li>\n<li>どうな情報を取得するかとか、</li>\n<li>APIのバージョンとか、</li>\n</ul>\n<p>色々あります。<br />\n（今回はこの辺の詳細は説明しませんが。）</p>\n<p>とりあえず、Amazonへリクエストを送るには、<br />\nこういった何かしらのURLを作る必要があると覚えておいてください。</p>\n<p>ちなみに、<code>http://webservices.amazon.com/onca/xml</code>の部分はエンドポイントと呼ばれる部分ですが、国ごとに異なります。<br />\n日本のamazonサイトからの結果を返したい場合は、<code>http://webservices.amazon.com/onca/xml</code>を<code>http://ecs.amazonaws.jp/onca/xml</code>に書き換えてご利用ください。</p>\n<table class=\"table\">\n<thead>\n<tr>\n<th>国</th>\n<th>エンドポイント</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CA (カナダ)</td>\n<td>http://ecs.amazonaws.ca/onca/xml<br />\nhttps://aws.amazonaws.ca/onca/xml</td>\n</tr>\n<tr>\n<td>DE (ドイツ)</td>\n<td>http://ecs.amazonaws.de/onca/xml<br />\nhttps://aws.amazonaws.de/onca/xml</td>\n</tr>\n<tr>\n<td>FR (フランス)</td>\n<td>http://ecs.amazonaws.fr/onca/xml<br />\nhttps://aws.amazonaws.fr/onca/xml</td>\n</tr>\n<tr>\n<td>JP (日本)</td>\n<td>http://ecs.amazonaws.jp/onca/xml<br />\nhttps://aws.amazonaws.jp/onca/xml</td>\n</tr>\n<tr>\n<td>UK (イギリス)</td>\n<td>http://ecs.amazonaws.co.uk/onca/xml<br />\nhttps://aws.amazonaws.co.uk/onca/xml</td>\n</tr>\n<tr>\n<td>US (アメリカ)</td>\n<td>http://ecs.amazonaws.com/onca/xml<br />\nhttps://aws.amazonaws.com/onca/xml</td>\n</tr>\n</tbody>\n</table>\n<h2><span id=\"URL\">リクエストURL作成の概要</span></h2>\n<p>Amazonへリクエストを送るには、URLを作らないといけないことが分かったかと思います。</p>\n<p><span style=\"font-size: 18pt;\"><strong>AmazonはそのURLの作り方が<span style=\"color: #ff0000;\">かなり複雑</span>なんですよね。</strong></span></p>\n<p>なので、今回はその概要だけ説明します。<br />\n（実際のプログラミングについては、次回説明しますので、概要が必要でない方は飛ばしていただいてもかまいません。）</p>\n<p>以下の手順をプログラムで行うと思っていてください。</p>\n<h3><span id=\"i\">０．元となるリクエスト</span></h3>\n<p>リクエストは、上で例にも挙げたように、<br />\n何かしらのURLがあって、<br />\n「?」でつなぎ、パラメーターが続くといった形です。</p>\n<p><span style=\"font-size: 12pt;\"><strong>[URL]?[パラメーター1]=値&amp;[パラメーター2]=値&amp;[パラメーター3]=値・・・（いくつでも）</strong></span></p>\n<p>のような感じです。<br />\nパラメーターは「&amp;」でつなぎます。</p>\n<p>今回は、上にも挙げたのと同じ</p>\n<blockquote><p>http://webservices.amazon.com/onca/xml?Service=AWSECommerceService&amp;AWSAccessKeyId=AKIAIOSFODNN7EXAMPLE&amp;Operation=ItemLookup&amp;ItemId=0679722769&amp;ResponseGroup=ItemAttributes,Offers,Images,Reviews&amp;Version=2009-01-06</p></blockquote>\n<p>このリクエストをもとにしていきます。<br />\nAmazonから結果を返してもらうには、<strong>こいつを変形していかなくてはいけない</strong>んですね。</p>\n<p>以下からがAmazon公式に載っている手順です。</p>\n<h3><span id=\"i-2\">１．タイムスタンプを付ける</span></h3>\n<p>パラメーターとしてタイムスタンプを追加します。<br />\nUTC（協定世界時）で、形式は「2014-09-09T12:35:00Z」</p>\n<p>のような形です。</p>\n<p>【変更後】</p>\n<blockquote><p>http://webservices.amazon.com/onca/xml?Service=AWSECommerceService&amp;AWSAccessKeyId=AKIAIOSFODNN7EXAMPLE&amp;Operation=ItemLookup&amp;ItemId=0679722769&amp;ResponseGroup=ItemAttributes,Offers,Images,Reviews&amp;Version=2009-01-06<span style=\"color: #ff0000;\"><strong>&amp;Timestamp=2009-01-01T12:00:00Z</strong></span></p></blockquote>\n<h3><span id=\"RFC_3986\">２．「RFC 3986」形式でパラメーターの値をエンコーディング</span></h3>\n<p>わたしなんかは、この辺で「なんのこっちゃ」って感じでした。<br />\nなんか日本語や一部の記号を16進数にしてくれてるみたいですね。<br />\nアルファベットはそのままです。</p>\n<p>「RFC 3986」を知らなくても、PHPにはちゃんと関数が用意されているので、変換することは可能です！<br />\n（大好き！PHP）</p>\n<p>【変更後】</p>\n<blockquote><p>http://webservices.amazon.com/onca/xml?Service=AWSECommerceService&amp;AWSAccessKeyId=AKIAIOSFODNN7EXAMPLE&amp;Operation=ItemLookup&amp;ItemId=0679722769&amp;ResponseGroup=ItemAttributes<strong><span style=\"color: #ff0000;\">%2C</span></strong>Offers<strong><span style=\"color: #ff0000;\">%2C</span></strong>Images<strong><span style=\"color: #ff0000;\">%2C</span></strong>Reviews&amp;Version=2009-01-06&amp;Timestamp=2009-01-01T12<strong><span style=\"color: #ff0000;\">%3A</span></strong>00<strong><span style=\"color: #ff0000;\">%3A</span></strong>00Z</p></blockquote>\n<h3><span id=\"i-3\">３．「&amp;」とか消して改行</span></h3>\n<p>「http」から「?」までを消して、</p>\n<p>「&amp;」のところで、改行していきます。（「&amp;」も消しますよ。）</p>\n<p>【変更後】</p>\n<blockquote><p>Service=AWSECommerceService<br />\nAWSAccessKeyId=AKIAIOSFODNN7EXAMPLE<br />\nOperation=ItemLookup<br />\nItemId=0679722769<br />\nResponseGroup=ItemAttributes%2COffers%2CImages%2CReviews<br />\nVersion=2009-01-06<br />\nTimestamp=2009-01-01T12%3A00%3A00Z</p></blockquote>\n<h3><span id=\"i-4\">４．パラメーター名で昇順ソート</span></h3>\n<p>パラメーターでソートします。<br />\n昇順なので、Aから順番ですね。</p>\n<p>【変更後】</p>\n<blockquote><p><strong><span style=\"color: #ff0000;\">A</span></strong>WSAccessKeyId=AKIAIOSFODNN7EXAMPLE<br />\n<strong><span style=\"color: #ff0000;\">I</span></strong>temId=0679722769<br />\n<strong><span style=\"color: #ff0000;\">O</span></strong>peration=ItemLookup<br />\n<strong><span style=\"color: #ff0000;\">R</span></strong>esponseGroup=ItemAttributes%2COffers%2CImages%2CReviews<br />\n<strong><span style=\"color: #ff0000;\">S</span></strong>ervice=AWSECommerceService<br />\n<strong><span style=\"color: #ff0000;\">T</span></strong>imestamp=2009-01-01T12%3A00%3A00Z<br />\n<strong><span style=\"color: #ff0000;\">V</span></strong>ersion=2009-01-06</p></blockquote>\n<h3><span id=\"i-5\">５．もう一度「&amp;」でつなぐ</span></h3>\n<p>ソートした後、また「&amp;」でつないでいきます。</p>\n<p>【変更後】</p>\n<blockquote><p>AWSAccessKeyId=AKIAIOSFODNN7EXAMPLE<strong><span style=\"color: #ff0000;\">&amp;</span></strong>ItemId=0679722769<strong><span style=\"color: #ff0000;\">&amp;</span></strong>Operation=ItemLookup<strong><span style=\"color: #ff0000;\">&amp;</span></strong>ResponseGroup=ItemAttributes%2COffers%2CImages%2CReview<span style=\"line-height: 1.6;\">s<strong><span style=\"color: #ff0000;\">&amp;</span></strong>Service=AWSECommerceService<strong><span style=\"color: #ff0000;\">&amp;</span></strong>Timestamp=2009-01-01T12%3A00%3A00Z<strong><span style=\"color: #ff0000;\">&amp;</span></strong></span><span style=\"line-height: 1.6;\">Version=2009-01-06</span></p></blockquote>\n<h3><span id=\"3\">６．3行を頭に追加</span></h3>\n<p>GET<br />\nwebservices.amazon.com<br />\n/onca/xml</p>\n<p>の3行を頭に追加します。<br />\n下はそのままです。</p>\n<p>【変更後】</p>\n<blockquote><p><strong><span style=\"color: #ff0000;\">GET</span></strong><br />\n<strong><span style=\"color: #ff0000;\"> webservices.amazon.com</span></strong><br />\n<strong><span style=\"color: #ff0000;\"> /onca/xml</span></strong><br />\nAWSAccessKeyId=AKIAIOSFODNN7EXAMPLE&amp;ItemId=0679722769&amp;Operation=ItemLookup&amp;ResponseGroup=ItemAttributes%2COffers%2CImages%2CReviews&amp;Service=AWSECommerceService&amp;Timestamp=2009-01-01T12%3A00%3A00Z&amp;Version=2009-01-06</p></blockquote>\n<h3><span id=\"i-6\">７．よく分からんエンコーディング</span></h3>\n<p>シークレットキーを使って「HMAC-SHA256」でハッシュ値を算出するみたいです。<br />\n（日本語が正しいかも怪しい・・・。）</p>\n<p>この辺もPHPの関数があるので、理解してなくても作ることはできます。<br />\n理解しといた方がいいとは思いますが、<strong>わたしは分かってません！</strong></p>\n<p>【変更後】</p>\n<blockquote><p>M%2Fy0%2BEAFFGaUAp4bWv%2FWEuXYah99pVsxvqtAuC8YN7I%3D</p></blockquote>\n<h3><span id=\"Signature\">８．「Signature」として最後に追加</span></h3>\n<p>先ほど「HMAC-SHA256」で作られた値を、パラメーター「Signature」としてリクエストURLの最後に追加します。</p>\n<p>[URL]?[パラメーター1]=値&amp;[パラメーター2]=値&amp;[パラメーター3]=値・・・<strong>&amp;Signature=[7で作られた値]</strong></p>\n<p>のような感じです。</p>\n<p>【変更後】</p>\n<blockquote><p>http://webservices.amazon.com/onca/xml?AWSAccessKeyId=AKIAIOSFODNN7EXAMPLE&amp;ItemId=0679722769&amp;Operation=ItemLookup&amp;ResponseGroup=ItemAttributes%2COffers%2CImages%2CReviews&amp;Service=AWSECommerceService&amp;Timestamp=2009-01-01T12%3A00%3A00Z&amp;Version=2009-01-06<span style=\"color: #ff0000;\"><strong>&amp;Signature=M%2Fy0%2BEAFFGaUAp4bWv%2FWEuXYah99pVsxvqtAuC8YN7I%3D</strong></span></p></blockquote>\n<h2><span id=\"URLURL\">この手順で作られたURLがリクエストURL</span></h2>\n<p>この面倒な手順を踏んで作られたURLがAmazonへ送るURLです。</p>\n<p>元となるURLを作成したら、<br />\nプログラムで変形に次ぐ変形をさせてリクエストURLを作っていく感じですね。</p>\n<p>手順はザーッと見るくらいで、<br />\n実際にプログラムで動かした方が理解が早いと思うので、<br />\n次はPHPで動くプログラムを作っていきましょう！<br />\n<h2><span id=\"i-7\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome --><br />\nリクエストURL作成の概要の紹介でした！<br />\n次は実際に動くプログラムを作っていきます。</p>\n<div class=\"box box-link\">\n※ 以下エントリーは、PA-API4.0時点のものとなります。<strong class=\"marker\">2019年12月1日から新しいバージョン5.0のPA-API（Product Advertising API）と移行</strong>するため、これからPA-APIをご利用の方は、以下のv5.0の記事をご参考ください。</p>\n<blockquote class=\"wp-embedded-content\" data-secret=\"ucgPo4gSbh\"><p><a href=\"https://haniwaman.com/pa-api-5/\">4.0から大きく変わった「PA-API v5.0」の使い方！</a></p></blockquote>\n<p><iframe title=\"&#8220;4.0から大きく変わった「PA-API v5.0」の使い方！&#8221; &#8212; HPcode\" class=\"wp-embedded-content\" sandbox=\"allow-scripts\" security=\"restricted\" style=\"position: absolute; clip: rect(1px, 1px, 1px, 1px);\" src=\"https://haniwaman.com/pa-api-5/embed/#?secret=ucgPo4gSbh\" data-secret=\"ucgPo4gSbh\" width=\"500\" height=\"282\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\"></iframe>\n</div>\n<p>第1回：<a href=\"https://haniwaman.com/amazon-api-1/\">アソシエイトタグの取得</a><br />\n第2回：<a href=\"https://haniwaman.com/amazon-api-2/\">アクセスキーとシークレットキーの取得</a><br />\n第3回：<a href=\"https://haniwaman.com/amazon-api-3/\">リクエストURL作成の概要</a><br />\n第4回：<a href=\"https://haniwaman.com/amazon-api-4/\">リクエストURLの作成（PHP）と結果（XML）の確認－</a><br />\n第5回：<a href=\"https://haniwaman.com/amazon-api-5/\">リクエスト結果（XML）の表示</a><br />\n第6回：<a href=\"https://haniwaman.com/amazon-api-6/\">パラメーターの種類とか</a><br />\n最終回：<a href=\"https://haniwaman.com/amazon-api-7/\">実際に作ってみよう</a></p>\n","date":"December 24, 2017","categories":[{"name":"Web API","slug":"web-api"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"f1f6bac3-6cdc-50fa-8935-55a25c895db4"}}}