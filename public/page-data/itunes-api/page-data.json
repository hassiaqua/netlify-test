{"componentChunkName":"component---src-templates-post-js","path":"/itunes-api/","result":{"data":{"wordpressPost":{"id":"29ea0fd0-8864-5c5f-abfd-2be349b43c09","title":"【PHP】iTunes APIで音楽の試聴音源を取得する方法","slug":"itunes-api","content":"<p>iTunes APIを使って、Appleが提供している音楽の<strong class=\"marker\">試聴音源を取得する方法</strong>です。</p>\n<p>ストアで音楽を購入する時に30秒ほどの視聴ができると思いますが、その音源を取得できるものになります。iTunes Stroe関連のリンクのお供にぜひお使いください。</p>\n<p>公式サイトはこちらです。<br />\n→ <a href=\"https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/\" rel=\"noopener\" target=\"_blank\">iTunes Search API – Partner Resources</a></p>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#iTunes_API\"><span class=\"toc_number toc_depth_1\">1</span> iTunes APIで音楽の試聴音源を取得する方法</a><ul><li><a href=\"#i\"><span class=\"toc_number toc_depth_2\">1.1</span> リクエストパラメーターを音楽だけに絞り込む</a></li><li><a href=\"#i-2\"><span class=\"toc_number toc_depth_2\">1.2</span> アフィリエイト報酬を受取たい場合</a></li><li><a href=\"#CSS\"><span class=\"toc_number toc_depth_2\">1.3</span> CSSで見栄えを整える</a></li></ul></li><li><a href=\"#i-3\"><span class=\"toc_number toc_depth_1\">2</span> おわり</a></li></ul></div>\n<h2><span id=\"iTunes_API\">iTunes APIで音楽の試聴音源を取得する方法</span></h2>\n<p>PHPでiTunes APIで音楽の試聴音源を取得していきます。まずは全体的なコードを一気に書いてみました。キーワードに関連した以下のようなかたまりが10件表示されるものになります。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/07/itunes-api1.png\" alt=\"\" width=\"350\" class=\"alignnone size-full wp-image-15983\" /></p>\n<p>iTunes APIは、シンプルに使わせてくれる親切設計なので、それほど難しくはないと思います。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"php\">&lt;?php\r\n$json    = [];\r\n$keyword = 'moumoon';\r\n\r\n$base              = 'https://itunes.apple.com/search';\r\n$params            = [];\r\n$params['term']    = rawurlencode( $keyword );\r\n$params['country'] = 'jp';\r\n$params['media']   = 'music';\r\n$params['entity']  = 'musicTrack';\r\n$params['lang']    = 'ja_jp';\r\n$params['limit']   = 10;\r\n\r\n$request = '';\r\nforeach ( $params as $k =&gt; $v ) {\r\n\t$request .= '&amp;' . $k . '=' . $v;\r\n}\r\n$request = $base . '?' . substr( $request, 1 );\r\n$json    = json_decode( file_get_contents( $request ), true );\r\n?&gt;\r\n&lt;?php\r\nif ( isset( $json['results'] ) &amp;&amp; count( $json['results'] ) &gt; 0 ) :\r\n\t?&gt;\r\n\r\n\t&lt;?php\r\n\tforeach ( $json['results'] as $result ) :\r\n\t\t?&gt;\r\n&lt;div class=\"itunes-preview\"&gt;\r\n\t&lt;div class=\"itunes-preview-info\"&gt;\r\n\t\t&lt;div class=\"itunes-preview-img\"&gt;\r\n\t\t\t&lt;img src=\"&lt;?php echo $result['artworkUrl100']; ?&gt;\"&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;div class=\"itunes-preview-body\"&gt;\r\n\t\t\t&lt;div class=\"itunes-preview-title\"&gt;&lt;?php echo $result['trackName']; ?&gt;&lt;/div&gt;\r\n\t\t\t&lt;div class=\"itunes-preview-artist\"&gt;&lt;?php echo $result['artistName']; ?&gt;&lt;/div&gt;\r\n\t\t\t&lt;div class=\"itunes-preview-price\"&gt;&lt;?php echo $result['trackPrice']; ?&gt;円&lt;/div&gt;\r\n\t\t\t&lt;div class=\"itunes-preview-link\"&gt;&lt;a href=\"&lt;?php echo $result['trackViewUrl']; ?&gt;\" target=\"_blank\"&gt;iTunes からダウンロード&lt;/a&gt;&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t&lt;/div&gt;\r\n\t&lt;div class=\"itunes-preview-audio\"&gt;&lt;audio src=\"&lt;?php echo $result['previewUrl']; ?&gt;\" controls&gt;&lt;/audio&gt;&lt;/div&gt;\r\n\t&lt;div class=\"itunes-preview-provided\"&gt;provided courtesy of iTunes&lt;/div&gt;\r\n&lt;/div&gt;&lt;!-- /itunes-preview --&gt;\r\n\r\n\t\t&lt;?php\r\n\tendforeach;\r\n\t?&gt;\r\n\r\n\t&lt;?php\r\n\telse :\r\n\t\t?&gt;\r\n&lt;p&gt;コンテンツが見つかりませんでした&lt;/p&gt;\r\n\t\t&lt;?php\r\nendif;\r\n\t?&gt;</code></pre>\n<h3><span id=\"i\">リクエストパラメーターを音楽だけに絞り込む</span></h3>\n<p><code>country</code>と<code>lang</code>で日本。<code>media</code>で音楽。<code>entity</code>で個別の音楽。の指定を行っています。</p>\n<p><code>limit</code>で取得する件数。これは1から200まで指定が可能です。</p>\n<p>そして、<code>term</code>が検索キーワード。この値はURLエンコードしてあげてください。</p>\n<p>このようにパラメーターとして取得したい情報を付け加えてあげることで、iTunes APIから柔軟に結果を返してもらえるようになります。</p>\n<p>指定できる全てのパラメーターは公式ドキュメントに掲載されているので、他の情報が欲しい場合はドキュメントを確認しつつカスタマイズしてみてください！<br />\n→ <a href=\"https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/#overview\" rel=\"noopener\" target=\"_blank\">iTunes Search API – Partner Resources</a></p>\n<h3><span id=\"i-2\">アフィリエイト報酬を受取たい場合</span></h3>\n<p>上記のコードでiTunesへのリンクを取得できましたが、アフィリエイトリンクではなくただのリンクです。自身のアフィリエイト報酬を受取るためのタグを入れたい場合は、パラーメーターとして<code>at</code>を追加してあげてください。</p>\n<p>値として使うのは「パートナートークン」です。</p>\n<p>パラメーターを作成する部分だけ抜粋すると以下のような感じになります。<code>$params['at']</code>の行を追加してあげてください。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-1\">コピー</span><code id=\"code-1\" class=\"php\">$params            = [];\r\n$params['term']    = rawurlencode( $keyword );\r\n$params['country'] = 'jp';\r\n$params['media']   = 'music';\r\n$params['entity']  = 'musicTrack';\r\n$params['lang']    = 'ja_jp';\r\n$params['limit']   = 10;\r\n$params['at']      = '[ご自身のパートナートークン]';</code></pre>\n<h3><span id=\"CSS\">CSSで見栄えを整える</span></h3>\n<p>この記事のコードで取得すると以下のようなHTMLタグで出力されます。各要素に対して<code>itunes-preview</code>クラスを当てているので、ご自身の好きなようにCSSを当ててデザインを適応してあげてください。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-2\">コピー</span><code id=\"code-2\" class=\"html\">&lt;div class=\"itunes-preview\"&gt;\r\n\t&lt;div class=\"itunes-preview-info\"&gt;\r\n\t\t&lt;div class=\"itunes-preview-img\"&gt;\r\n\t\t\t&lt;img src=\"https://is2-ssl.mzstatic.com/image/thumb/Music/v4/28/4b/4d/284b4d42-9685-722a-17fc-94133f1bc1ef/source/100x100bb.jpg\"&gt;\r\n\t\t&lt;/div&gt;\r\n\t\t&lt;div class=\"itunes-preview-body\"&gt;\r\n\t\t\t&lt;div class=\"itunes-preview-title\"&gt;Sunshine Girl&lt;/div&gt;\r\n\t\t\t&lt;div class=\"itunes-preview-artist\"&gt;moumoon&lt;/div&gt;\r\n\t\t\t&lt;div class=\"itunes-preview-price\"&gt;200円&lt;/div&gt;\r\n\t\t\t&lt;div class=\"itunes-preview-link\"&gt;&lt;a href=\"https://music.apple.com/jp/album/sunshine-girl/380070803?i=380070870&amp;uo=4&amp;partnerId=11\" target=\"_blank\"&gt;iTunes からダウンロード&lt;/a&gt;&lt;/div&gt;\r\n\t\t&lt;/div&gt;\r\n\t&lt;/div&gt;\r\n\t&lt;div class=\"itunes-preview-audio\"&gt;&lt;audio src=\"https://audio-ssl.itunes.apple.com/itunes-assets/Music/v4/c9/4a/64/c94a6437-40e8-4605-31ef-8e9ae7a16d68/mzaf_664088345225297932.plus.aac.p.m4a\" controls&gt;&lt;/audio&gt;&lt;/div&gt;\r\n\t&lt;div class=\"itunes-preview-provided\"&gt;provided courtesy of iTunes&lt;/div&gt;\r\n&lt;/div&gt;&lt;!-- /itunes-preview --&gt;</code></pre>\n<h2><span id=\"i-3\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome -->\n<p>iTunes APIで音楽の試聴音源を取得する方法でした。ドキュメントが英語ですが、一般的なWeb APIと使い方は変わらないので、他のWeb APIを使われたことがある方なら特に違和感なく利用できると思います。</p>\n<p>ただ利用にあたって、<strong class=\"marker\">あくまでもiTunesを通じての音楽のプロモーションが目的</strong>なので、iTunesへのリンクを貼らなったりコンテンツと関係なく音源だけ使う、みたいな使い方はしないようにしましょう&#8230;</p>\n","date":"July 25, 2019","categories":[{"name":"Web API","slug":"web-api"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"29ea0fd0-8864-5c5f-abfd-2be349b43c09"}}}