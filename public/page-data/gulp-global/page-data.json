{"componentChunkName":"component---src-templates-post-js","path":"/gulp-global/","result":{"data":{"wordpressPost":{"id":"19a3e949-2d86-544f-842e-dfa4c57909e9","title":"npmでグローバルにインストールしてGulpを実行する方法","slug":"gulp-global","content":"<p>何十件とGulpでタスクを動かしながらコーディングしてきて、ある日ふと気づきました。</p>\n<p>「<span class=\"font-l\"><strong class=\"marker\">あれ、毎回ほぼ同じタスクじゃね？</strong></span>」</p>\n<p>今まで、プロジェクトごとに<code>npm install</code>ごっそりインストールしていましたが、大量のファイルが出来上がって容量を圧迫するので、globalに一括に入れてしまって同じやつを呼んで使おうという作戦に切り替えました。</p>\n<p>この記事では、gulpをグローバルから参照するために自分がしたことをまとめています。</p>\n<div class=\"chat\"><figure class=\"chat-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"><figcaption>はにわまん</figcaption></figure><div class=\"chat-content\">Macのターミナルからパスを追加したりとコマンドの操作が多いですが、何が起きても自己責任でお願いいたします...。</div></div>\n<div id=\"toc_container\" class=\"no_bullets\"><p class=\"toc_title\">目次</p><ul class=\"toc_list\"><li><a href=\"#npm\"><span class=\"toc_number toc_depth_1\">1</span> 【前提】npmのグローバルとローカルの違い</a><ul><li><a href=\"#i\"><span class=\"toc_number toc_depth_2\">1.1</span> ローカルにインストールするメリット・デメリット</a></li><li><a href=\"#i-2\"><span class=\"toc_number toc_depth_2\">1.2</span> グローバルにインストールするメリット・デメリット</a></li></ul></li><li><a href=\"#globalnpm\"><span class=\"toc_number toc_depth_1\">2</span> globalにnpmインストールするとファイルはどこに保存される？</a></li><li><a href=\"#global\"><span class=\"toc_number toc_depth_1\">3</span> globalにインストールする方法</a></li><li><a href=\"#i-3\"><span class=\"toc_number toc_depth_1\">4</span> グローバルへインストールするにあたってコマンドまどめ</a><ul><li><a href=\"#i-4\"><span class=\"toc_number toc_depth_2\">4.1</span> インストールされる先のフォルダの確認</a></li><li><a href=\"#Gulprequireglobal\"><span class=\"toc_number toc_depth_2\">4.2</span> Gulpのrequireから参照できるglobalのパスのリスト</a></li><li><a href=\"#Mac\"><span class=\"toc_number toc_depth_2\">4.3</span> Macでパスを通す</a></li><li><a href=\"#i-5\"><span class=\"toc_number toc_depth_2\">4.4</span> テストしてみる</a></li><li><a href=\"#VSCodeGulp\"><span class=\"toc_number toc_depth_2\">4.5</span> VSCodeからGulpが通らない時</a></li></ul></li><li><a href=\"#i-6\"><span class=\"toc_number toc_depth_1\">5</span> おわり</a></li></ul></div>\n<h2><span id=\"npm\">【前提】npmのグローバルとローカルの違い</span></h2>\n<p>npmのインストールにはグローバルとローカルの2つがあります。ざっくりとは以下の違いになります。</p>\n<ul class=\"check\">\n<li>グローバル・・・ローカル上の特定の1つのフォルダ内にまとめてインストール</li>\n<li>ローカル・・・各（プロジェクト）フォルダごとに都度インストール</li>\n</ul>\n<p>どちらを採用するにしても、それぞれのメリット・デメリットを理解しておいた方がいいかと思うので、以下にまとめます。</p>\n<h3><span id=\"i\">ローカルにインストールするメリット・デメリット</span></h3>\n<p>まずは、ローカルにインストールするメリット・デメリットからです。</p>\n<h4>メリット</h4>\n<p>ローカルにインストールするメリットとしては、<strong class=\"marker\">プロジェクトごとにnpmパッケージを管理できる</strong>点。必要十分なパッケージだけを利用できるので、何をどのバージョン時に使っていたのかをチームメンバーやあとから保守する人が分かりやすいという点があるかと思います。</p>\n<h4>デメリット</h4>\n<p>ローカルにインストールするデメリットとしては、<strong class=\"marker\">プロジェクトが増えるにつれて容量が圧迫される</strong>点。npmをインストールした時にできる<span class=\"folder\">node_module</span>フォルダってめちゃくちゃ重いんですよね&#8230;</p>\n<p>プロジェクトごとに<span class=\"folder\">node_module</span>が格納さていくので、じわじわと容量を埋めていきます。</p>\n<h3><span id=\"i-2\">グローバルにインストールするメリット・デメリット</span></h3>\n<p>続いてグローバルにインストールするメリットとデメリットです。</p>\n<h4>メリット</h4>\n<p>メリットとしては、参照先が1つになって<strong class=\"marker\">いちいちパッケージをインストールしなくても済む</strong>点（既にグローバルにインストールされていればですが）。</p>\n<p>同じようなパッケージしか使わない人（自分のようないつも同じパッケージを使っている人）は、いちいちプロジェクトごとにインストールする必要性はあまりないはずです。</p>\n<h4>デメリット</h4>\n<p>プロジェクトで使っていた時の<strong class=\"marker\">パッケージのバージョンが把握しづらい</strong>です。また、<strong class=\"marker\">プロジェクトに最低限で必要なパッケージがどれかも分かりません</strong>。</p>\n<p>なので、案件ごとにバージョンやパッケージが変わる場合は、グローバルからの参照にしないほうが、あとの自分（やチーム開発の場合はチームメイト）が助かると思います。</p>\n<h2><span id=\"globalnpm\">globalにnpmインストールするとファイルはどこに保存される？</span></h2>\n<p>以下のコマンドから場所を把握することが可能です。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"cli\">npm root -g\r\n</code></pre>\n<p>実行すると、ローカルインストールしていたときにも見慣れた「node_modules」までのパスを表示してくれます。ここが自分のPC上の<code>npm install -g</code>でインストールされる先のパスになります。<br />\n/Users/user-name/node_modules/lib/node_modules</p>\n<h2><span id=\"global\">globalにインストールする方法</span></h2>\n<p><code>-g</code>のオプションを付けてあげるとグローバルへのインストールとなります。バージョンを指定しないと最新のバージョンとなってしまうので、これまで安定稼働していた<span class=\"filename\">package.json</span>のバージョンを指定してげてインストールするといいかもしれません。</p>\n<p>以下は、グローバルへのインストール例です。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-1\">コピー</span><code id=\"code-1\" class=\"cli\">npm install -g autoprefixer@8.2.0\r\n</code></pre>\n<h2><span id=\"i-3\">グローバルへインストールするにあたってコマンドまどめ</span></h2>\n<p>色んな値の確認や設定するにあたってのコマンドをまとめました。</p>\n<h3><span id=\"i-4\">インストールされる先のフォルダの確認</span></h3>\n<p><code>npm install -g</code>した時にインストールされる先のフォルダを確認するには、以下のコマンドを実行します。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-0\">コピー</span><code id=\"code-0\" class=\"cli\">npm root -g\r\n</code></pre>\n<p><img src=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global1-700x70.png\" alt=\"\" width=\"400\" class=\"alignnone size-medium wp-image-16438\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global1-700x70.png 700w, https://haniwaman.com/wp-content/uploads/2019/10/gulp-global1.png 716w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<p>このパスが<a href=\"#global-path\">次のセクション</a>の「Gulpの<code>require</code>から参照できるglobalのパスのリスト」に指定されている必要があります。<br />\n（色々と連動していて、ややこしい&#8230;）</p>\n<p>もしくは、このパス（<code>-g</code>でインストールされる先のフォルダ）が気に入らない場合は変更も可能です。</p>\n<h4><code>npm root -g</code>のパスを変更する方法</h4>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-3\">コピー</span><code id=\"code-3\" class=\"cli\">npm config set prefix '~/node_modules'\r\n</code></pre>\n<p>例えば上記のようにすれば、自身のホーム配下の「node_modules」となります。</p>\n<h3 id=\"global-path\"><span id=\"Gulprequireglobal\">Gulpの<code>require</code>から参照できるglobalのパスのリスト</span></h3>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-4\">コピー</span><code id=\"code-4\" class=\"cli\">node\r\n&gt; global.module.paths\r\n&gt; .exit</code></pre>\n<p><img src=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global3-700x288.png\" alt=\"\" width=\"400\" class=\"alignnone size-medium wp-image-16440\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global3-700x288.png 700w, https://haniwaman.com/wp-content/uploads/2019/10/gulp-global3-768x316.png 768w, https://haniwaman.com/wp-content/uploads/2019/10/gulp-global3.png 774w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<p>ここで表示されたパスがGulpのrequireから参照できるglobalのパスのリストです。<strong class=\"marker\">ここのフォルダのどこかにパッケージがインストールされていれば参照できます</strong>。</p>\n<p>もしグローバルにない状態でGulpから参照しようとすると、「Error: Cannot find module &#8216;hogehoge&#8217;」のような感じで、エラーとなります。<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global2.png\" alt=\"\" width=\"400\" class=\"alignnone size-full wp-image-16439\" /></p>\n<p>ちなみに、こんな感じで適当に書いています。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-5\">コピー</span><code id=\"code-5\" class=\"\">var hogehoge = require(\"hogehoge\");\r\n</code></pre>\n<h3><span id=\"Mac\">Macでパスを通す</span></h3>\n<p>先ほどの<strong>global.module.paths</strong>へパスを追加するには<code>$NODE_PATH</code>に追加してあげる。コマンドは以下のとおりです。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-6\">コピー</span><code id=\"code-6\" class=\"cli\">NODE_PATH=`npm root -g`\r\n</code></pre>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-7\">コピー</span><code id=\"code-7\" class=\"cli\">export NODE_PATH\r\n</code></pre>\n<p>これは、<code>npm install -g</code>のインストール先のフォルダを<strong>global.module.paths</strong>に追加してあげるものになります。</p>\n<p>さらに、gulp等のnpmでインストールしたコマンドへアクセスできるためのパスを通してあげましょう。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-8\">コピー</span><code id=\"code-8\" class=\"cli\">source ~/.bash_profile\r\n</code></pre>\n<p>さらに上記のコマンドでパスを通す。<span class=\"filename\">.bash_profile</span>は実態としては変数とパスが記載されているだけのテキストファイルでした。</p>\n<p>自分はなぜかここに追加されなかったので、手動で追記しました&#8230;。前に書かれているものから<strong>半角スペース</strong>をあけて「export NODE_PATH=/Users/hogehoge/node_modules/lib/node_modules」<br />\n<img src=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global4-700x89.png\" alt=\"\" width=\"400\" class=\"alignnone size-medium wp-image-16444\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global4-700x89.png 700w, https://haniwaman.com/wp-content/uploads/2019/10/gulp-global4-768x98.png 768w, https://haniwaman.com/wp-content/uploads/2019/10/gulp-global4.png 928w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<p>※ NODE_PATH=以降の値は、<code>npm root -g</code>の結果として返されるものを指定してあげればOKです。</p>\n<p>Macでのパスの通し方は、以下のQiitaの記事を参考にさせてもらいました。</p>\n<ul>\n<li><a href=\"https://qiita.com/soarflat/items/d5015bec37f8a8254380\" rel=\"noopener\" target=\"_blank\">PATHを通すために環境変数の設定を理解する (Mac OS X) &#8211; Qiita</a></li>\n<li><a href=\"https://qiita.com/shintarogit/items/70f193829f4360dca771\" rel=\"noopener\" target=\"_blank\">Node.js グローバルインストールでハマった &#8211; Qiita</a></li>\n</ul>\n<h3><span id=\"i-5\">テストしてみる</span></h3>\n<p>では一通りの準備が終わったところでテストしてみす。ローカルインストールは一切せずに、適当な場所に<span class=\"filename\">gulpfile.js</span>を作成して、以下のようなタスクを作ってみます。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-9\">コピー</span><code id=\"code-9\" class=\"js\">var gulp = require('gulp');\r\n\r\ngulp.task('test', function() {\r\n  console.log('Hello World!');\r\n});</code></pre>\n<p><code>require('gulp')</code>しているので、<code>npm install -g gulp</code>でグローバルにgulpをインストールしてあげてください。</p>\n<p>そして以下のように実行してあげると&#8230;「Hello World!」と表示されたら成功です！</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-10\">コピー</span><code id=\"code-10\" class=\"cli\">gulp test\r\n</code></pre>\n<p><img src=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global5-700x158.png\" alt=\"\" width=\"400\" class=\"alignnone size-medium wp-image-16446\" srcset=\"https://haniwaman.com/wp-content/uploads/2019/10/gulp-global5-700x158.png 700w, https://haniwaman.com/wp-content/uploads/2019/10/gulp-global5.png 702w\" sizes=\"(max-width: 700px) 100vw, 700px\" /></p>\n<h3><span id=\"VSCodeGulp\">VSCodeからGulpが通らない時</span></h3>\n<p>以下のコマンドを入力したら通るようになりました。</p>\n<pre><span class=\"code-copy\" data-clipboard-target=\"#code-11\">コピー</span><code id=\"code-11\" class=\"cli\">npm link gulp\r\n</code></pre>\n<p>globalインストールしたようにシンボリックリンク（ショートカットのようなもの）を付けてくれるものらしいですが、よく分かっていないので本当に自己責任で&#8230;。</p>\n<p>自分はこのコマンドで、ターミナルでは動いていたけど、VSCode付属のターミナルでは動かないというケースが解消されました。</p>\n<h2><span id=\"i-6\">おわり</span></h2><div class=\"matome\"><div class=\"matome-img\"><img src=\"https://haniwaman.com/wp-content/themes/hpcode/img/haniwa.png\" alt=\"\"></div><div class=\"matome-twitter\"><a href=\"https://twitter.com/haniwa008?ref_src=twsrc%5Etfw\" class=\"twitter-follow-button\" data-show-screen-name=\"false\" data-size=\"large\" data-lang=\"ja\" data-show-count=\"true\">Follow @haniwa008</a><script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></div></div><!-- /matome -->\n<p>めちゃくちゃ箇条書き風にバーっとGulpの実行をグローバルから参照するための流れを書いてみました（主には備忘録の側面が強いです&#8230;）</p>\n<p>グローバルからの参照に手間取っている人の助けに少しでも慣れたなら嬉しく思います。</p>\n","date":"November 23, 2019","categories":[{"name":"環境","slug":"setting"}],"tags":null,"author":{"name":"はにわまん","slug":"haniwaman"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"19a3e949-2d86-544f-842e-dfa4c57909e9"}}}